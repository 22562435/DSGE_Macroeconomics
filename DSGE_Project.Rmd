---
# IMPORTANT: Change settings here, but DO NOT change the spacing.
# Remove comments and add values where applicable.
# The descriptions below should be self-explanatory

title: "Macroeconomics Assignment"
#subtitle: "This will appear as Right Header"

documentclass: "elsarticle"

# --------- Thesis title (Optional - set to FALSE by default).
# You can move the details below around as you please.
Thesis_FP: FALSE
# Entry1: "An unbelievable study with a title spanning multiple lines."
# Entry2: "\\textbf{Some Guy}" # textbf for bold
# Entry3: "A thesis submitted toward the degree of Doctor of Philosophy"
# Uni_Logo: Tex/Logo.png # Place a logo in the indicated location (from your root, e.g. defaults to ~/Tex/Logo.png) and uncomment this line. Leave uncommented for no image
# Logo_width: 0.3 # If using a logo - use this to set width (size) of image
# Entry4: "Under the supervision of: \\vfill Prof. Joe Smith and Dr. Frank Smith"
# Entry5: "Stellenbosch University"
# Entry6: April 2020
# Entry7:
# Entry8:

# --------- Front Page
# Comment: ----- Follow this pattern for up to 5 authors
AddTitle: TRUE # Use FALSE when submitting to peer reviewed platform. This will remove author names.
Author1: "Liam Andrew Beattie"  # First Author - note the thanks message displayed as an italic footnote of first page.
Ref1: "Macroeconomics 871, Stellenbosch University, South Africa" # First Author's Affiliation
Email1: "22562435\\@sun.ac.za"

# ----- Manage headers and footers:
#BottomLFooter: $Title$
#BottomCFooter:
#TopLHeader: \leftmark # Adds section name at topleft. Remove comment to add it.
BottomRFooter: "\\footnotesize Page \\thepage" # Add a '#' before this line to remove footer.
addtoprule: TRUE
addfootrule: TRUE               # Use if footers added. Add '#' to remove line.

# --------- page margins:
margin: 2.3 # Sides
bottom: 2 # bottom
top: 2.5 # Top
HardSet_layout: TRUE # Hard-set the spacing of words in your document. This will stop LaTeX squashing text to fit on pages, e.g.
# This is done by hard-setting the spacing dimensions. Set to FALSE if you want LaTeX to optimize this for your paper.

# --------- Line numbers
linenumbers: FALSE # Used when submitting to journal

# ---------- References settings:
# You can download cls format here: https://www.zotero.org/ - simply search for your institution. You can also edit and save cls formats here: https://editor.citationstyles.org/about/
# Hit download, store it in Tex/ folder, and change reference below - easy.
bibliography: Tex/ref.bib       # Do not edit: Keep this naming convention and location.
csl: Tex/harvard-stellenbosch-university.csl # referencing format used.
# By default, the bibliography only displays the cited references. If you want to change this, you can comment out one of the following:
#nocite: '@*' # Add all items in bibliography, whether cited or not
# nocite: |  # add specific references that aren't cited
#  @grinold2000
#  @Someoneelse2010

# ---------- General:
RemovePreprintSubmittedTo: TRUE  # Removes the 'preprint submitted to...' at bottom of titlepage
Journal: "Journal of Finance"   # Journal that the paper will be submitting to, if RemovePreprintSubmittedTo is set to TRUE.
toc: FALSE                       # Add a table of contents
numbersections: TRUE             # Should sections (and thus figures and tables) be numbered?
fontsize: 11pt                  # Set fontsize
linestretch: 1.2                # Set distance between lines.
link-citations: TRUE            # This creates dynamic links to the papers in reference list.

### Adding additional latex packages:
header-includes:
  - \usepackage{sectsty}
  - \sectionfont{\bfseries\large}  # Makes section (heading #) bold and large
  - \subsectionfont{\bfseries\normalsize}  # Makes subsection (##) bold and normal size


output:
  pdf_document:
    keep_tex: TRUE
    template: Tex/TexDefault.txt
    fig_width: 3.5 # Adjust default figure sizes. This can also be done in the chunks of the text.
    fig_height: 3.5
abstract: |
  Almost an abstract
---

<!-- First: Set your default preferences for chunk options: -->

<!-- If you want a chunk's code to be printed, set echo = TRUE. message = FALSE stops R printing ugly package loading details in your final paper too. I also suggest setting warning = FALSE and checking for warnings in R, else you might find ugly warnings in your paper. -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width = 6, fig.height = 5, fig.pos="H", fig.pos = 'H')
# Note: Include = FALSE implies the code is executed, but not printed in your pdf.
# warning and message = FALSE implies ugly messages and warnings are removed from your pdf.
# These should be picked up when you execute the command chunks (code sections below) in your rmd, not printed in your paper!

# Lets load in example data, and see how this can be stored and later called from your 'data' folder.
if(!require("tidyverse")) install.packages("tidyverse")
library(tidyverse)
library(DynareR)
```



<!-- ############################## -->
<!-- # Start Writing here: -->
<!-- ############################## -->

```{r dynare-code-mod}

#Please note that this is not the correct mod file, but here for example purposes based on what i have currently 
dynareCodes_NKM <- "



var 
    c i b m h K lambda mu 
    Y w rk Pi_r mc pi 
    g tau d 
    R rB A;

varexo 
    epsilon_a epsilon_g epsilon_tau epsilon_R;

parameters 
    alpha beta delta phi_k phi_p eta theta gamma chi psi epsilon 
    rho_R R_star kappa_pi pi_star kappa_y Y_star 
    rho_g g_bar 
    rho_tau tau_bar 
    rho_a;

alpha     = 0.33;
beta      = 0.99;
delta     = 0.025;
phi_k     = 0;
phi_p     = 50;
eta       = 0;
theta     = 2;
gamma     = 1;
chi       = 1;
psi       = 1;
epsilon   = 6;

rho_R     = 0.8;
R_star    = 1/beta;
pi_star   = 1;
kappa_pi  = 1.2;
kappa_y   = 0;
Y_star    = 1;

rho_g     = 0.9;
g_bar     = 0.2;

rho_tau   = 0.9;
tau_bar   = 0.2;

rho_a     = 0.9;

model;

// 1. Household flow constraint
c + i + b + m = rB(-1)*b(-1) + m(-1)/pi + w*h + rk*K(-1) + Pi_r - tau;

// 2. Capital accumulation
K = (1 - delta)*K(-1) + i - (phi_k/2)*((i/K(-1) - delta)^2)*K(-1);

// 3. Profit
Pi_r = Y - rk*K(-1) - w*h - (phi_p/2)*(pi - 1)^2*Y;

// 4. FOC consumption
lambda = (c - eta*c(-1))^(-theta) - beta*eta*((c(+1) - eta*c)^(-theta));

// 5. FOC labour
h^gamma = lambda*w / chi;

// 6. FOC bonds
1 = beta*(lambda(+1)/lambda)*rB;

// 7. FOC money
lambda = psi/m + beta*(lambda(+1)/pi(+1));

// 8. FOC investment
mu = lambda / (1 - phi_k*(i/K(-1) - delta));

// 9. FOC capital
1 = beta*( (lambda(+1)/mu)*(rk(+1)) + (mu(+1)/mu)*(1 - delta - (phi_k/2)*(delta^2 - (i(+1)/K)^2)) );

// 10. Production
Y = A*K(-1)^alpha*h^(1 - alpha);


// 11. NK Phillips Curve
(pi - 1)*pi = (epsilon/phi_p)*(mc - (epsilon - 1)/epsilon) + beta*(lambda(+1)/lambda)*(Y(+1)/Y)*(pi(+1) - 1)*pi(+1);

// 12. Marginal cost
mc = (1/A)*((rk/alpha)^alpha)*((w/(1 - alpha))^(1 - alpha));

// 13. Government budget
g + rB(-1)*d(-1) = d + tau;

// 14. Resource constraint
Y = c + i + g + (phi_k/2)*((i/K(-1) - delta)^2)*K(-1) + (phi_p/2)*(pi - 1)^2*Y;

// 15. Bond market clearing
b = d;

// 16. Fisher equation
R = rB * pi(+1);

// 17. Taylor rule
R = rho_R*R(-1) + (1 - rho_R)*(R_star + kappa_pi*(pi - pi_star) + kappa_y*((Y - Y_star)/Y_star)) + epsilon_R;

// 18. Taxes
tau = (1 - rho_tau)*tau_bar + rho_tau*tau(-1) + epsilon_tau;

// 19. Government spending
g = (1 - rho_g)*g_bar + rho_g*g(-1) + epsilon_g;

// 20. Technology process
log(A) = rho_a*log(A(-1)) + epsilon_a;

end;

initval;
    c = 1.43; 
    i = 0.397; 
    b = 0; 
    m = 0.5;    // Initial guess, will be updated
    h = 0.733; 
    K = 15.88; 
    lambda = 0.489; 
    mu = 0.489; 
    Y = 2.027; 
    w = 1.54; 
    rk = 0.0351; 
    Pi_r = 0.1;  // Initial guess
    mc = 0.8333; 
    pi = 1; 
    g = 0.2; 
    tau = 0.2; 
    d = 0; 
    R = 1.0101; 
    rB = 1.0101; 
    A = 1;
end;

shocks;
    var epsilon_a; stderr 0.01;
    var epsilon_g; stderr 0.01;
    var epsilon_tau; stderr 0.01;
    var epsilon_R; stderr 0.01;
end;

steady;
check;
stoch_simul(order=1,irf=10);



"

# will set eval to true when happy with MOD file
write_mod(
  code  = dynareCodes_NKM,
  model = "code/nkm_model"
)

```

```{r running-dynare, eval=FALSE}


nkm_results <- run_dynare(
  code       = dynareCodes_NKM,    
  model      = "code/nkm_model",
  import_log = TRUE)

#dynare$nkm_model$steady
```



I have used an R package from @{Mati2019} and should give credit. This allowed me to code everything in R while still using Dynare. 

$$r^B_{t-1} = R^B_{t-1}/\pi_t$$


# Model Specification


\begin{equation}
\pi_t = \frac{P_t}{P_{t-1}}
\label{inflation}
\end{equation}


\begin{equation}
c_t = \frac{C_t}{P_t}, 
\quad i_t = \frac{I_t}{P_t}, 
\quad g_t = \frac{G_t}{P_t},
\quad b_t = \frac{B_t}{P_t}
\label{real_conversions}
\end{equation}



Above could note be a heading on itself. Just a paragraph that it is a core rbc foundations and what that means. 

As with \eqref{real_conversions}, it is a general rule that capital letters denote nominal amounts and lowercase denote real values, however to follow convention $K_t$ denotes real capital.



Mainly adding capital to  @sims2024newkeynesian, while also introducing adjustment costs from @sims2024rbc . Rotemberg prices was used while gleeming insights from @ecbwp770 .




## Households 


$c_t,\,h_t,\,m_t,\,b_t,\,K_t,\,i_t$ are all real values for consumption, hours worked, money, bonds, capital, and investment. 


\begin{equation}
\max_{\{c_t,\,h_t,\,m_t,\,b_t,\,K_t,\,i_t\}}
\mathbb{E}_0 \sum_{t=1}^{\infty} \beta^{t-1}
\left[
\frac{\Bigl(c_t - \eta\,c_{t-1}\Bigr)^{1-\theta}}{1-\theta}
\;-\;\chi\,\frac{h_t^{1+\gamma}}{1+\gamma}
\;+\;\psi\,\ln\!\Bigl(m_t\Bigr)
\right]
\label{lifetime_utility_real}
\end{equation}


\begin{equation}
c_t + i_t + b_t + m_t \leq r^B_{t-1}b_{t-1} + \dfrac{m_{t-1}}{\pi_t} + w_t h_t + r^k_t K_{t-1} + \Pi^r_t - \tau_t
\label{flow_constraint_real}
\end{equation}



\begin{equation}
K_t
\;=\;
(1 - \delta)\,K_{t-1}
\;+\; i_t
\;-\;\frac{\phi_k}{2}
\left(\frac{i_t}{K_{t-1}} - \delta\right)^{2}
\,K_{t-1}
\label{capital_accumulation_real}
\end{equation}

Households are the owners of all intermediate‐goods firms and receive the aggregate profits as lump‐sum income transfers each period.  Denoting aggregate real profits by $\Pi^r_t$, we can write

\begin{equation}
\Pi^r_t = Y_t - r^k_t K_{t-1} - w_t h_t - \dfrac{\phi_p}{2} (\pi_t - 1)^2 Y_t
\label{intermediate_firm_profit_real}
\end{equation}

where $P_tY_t$ is nominal revenue, $R^k_t K_{t-1}$ and $W_t h_t$ are total nominal factor payments, and the last term captures Rotemberg‐style price adjustment costs in nominal terms.




Households maximize expected lifetime utility over consumption and labour supply, taking all after-tax income—wages, rental income, bond returns, and profits—as given. In particular, we treat firm profits $\Pi_t$ as a lump‐sum transfer from firms that enters the budget constraint passively; households do not choose or time their utility over firm profits, nor do they form expectations about future payouts.  

From which we can derive the following first order conditions, found in full form in Appendix \ref{household_FOC}:


\begin{equation}\label{foc_C}
\lambda_t = (c_t-\eta c_{t-1})^{-\theta} - \beta\,\eta\,\mathbb{E}_t\bigl[(c_{t+1}-\eta c_t)^{-\theta}\bigr]
\end{equation}

\begin{equation}\label{foc_h}
\lambda_t w_t = \chi h_t^{\gamma}
\end{equation}

\begin{equation}\label{foc_B}
\lambda_t = \beta \, \mathbb{E}_t \left[ \lambda_{t+1} r^B_t \right]
\end{equation}



\begin{equation}\label{foc_M}
\dfrac{\psi}{m_t} = \lambda_t - \beta \, \mathbb{E}_t \left[ \dfrac{\lambda_{t+1}}{\pi_{t+1}} \right]
\end{equation}

\begin{equation}\label{foc_I}
\lambda_t = \mu_t \left( 1 - \phi_k \left( \frac{i_t}{K_{t-1}} - \delta \right) \right)
\end{equation}


\begin{equation}\label{foc_K}
\mu_t = \beta \, \mathbb{E}_t \left[ \lambda_{t+1} r^k_{t+1} + \mu_{t+1} \left( (1-\delta) - \frac{\phi_k}{2} \left( \delta^2 - \left( \frac{i_{t+1}}{K_t} \right)^2 \right) \right) \right]
\end{equation}








\newpage


## Production 


This model departs from standard RBC frameworks by introducing monopolistic competition and nominal rigidities. This is achieved through two layers of firms. The first being a perfectly competitive final goods producers, who aggregate intermediate goods, and the second being a monopolistically competitive intermediate goods producers with price-setting power.  This two-tiered structure captures core New Keynesian dynamics, such as price stickiness and strategic pricing, while retaining analytical tractability.


### Final Goods Producer

The final goods firm combines differentiated inputs \(Y_t(j)\) into final output \(Y_t\) using a CES aggregator:  

\begin{equation}  
Y_t = \left( \int_0^1 Y_t(j)^{\frac{\epsilon-1}{\epsilon}}  dj \right)^{\frac{\epsilon}{\epsilon-1}}, \quad \epsilon > 1  
\label{ces_production}  
\end{equation}  

Where \(\epsilon\) captures the elasticity of substitution between varieties: the higher it is, the more easily final goods producers can substitute across inputs. Conversely, a lower \(\epsilon\) implies that intermediate producers face less competition and enjoy greater market power.

Given the CES aggregator in Equation \eqref{ces_production}, the final goods producer chooses input varieties to minimize the cost of delivering one unit of output. The resulting demand and pricing relationships, derived in Appendix \ref{final_good_producer_appendix}, are:

  
\begin{equation}  
Y_t(j) = \left( \frac{P_t(j)}{P_t} \right)^{-\epsilon} Y_t  
\label{demand_curve_final}  
\end{equation}  

  
\begin{equation}  
P_t = \left( \int_0^1 P_t(j)^{1-\epsilon}  dj \right)^{\frac{1}{1-\epsilon}}  
\label{aggregate_price_index}  
\end{equation}
  
  
Equation \eqref{demand_curve_final} shows that more expensive varieties are purchased in smaller quantities, while Equation \eqref{aggregate_price_index} reflects the minimum cost of assembling one unit of final output given prevailing input prices.



### Intermediate Goods Producers




Each intermediate firm \(j\) produces with identical Cobb-Douglas technology:  
\begin{equation}
Y_t(j) = A_t K_t(j)^{\alpha} h_t(j)^{1-\alpha}
\label{intermediate_production}
\end{equation}

Cost minimization yields capital and labour demand conditions as well as the marginal cost:

\begin{equation}
r_t^k =m c_t \alpha A_t K_t(j)^{\alpha-1} h_t(j)^{1-\alpha}
\label{Capital_Demand_Condition}
\end{equation}

\begin{equation}
w_t = mc_t (1-\alpha) A_t K_t(j)^{\alpha} h_t(j)^{-\alpha}
\label{Labour_Demand_Condition}
\end{equation}



\begin{equation}
\text{mc}_t = \frac{1}{A_t} \left( \frac{r_t^k}{\alpha} \right)^{\alpha} \left( \frac{w_t}{1-\alpha} \right)^{1-\alpha}
\label{marginal_cost}
\end{equation}


Equation \eqref{marginal_cost}, which is derived in Appendix \ref{intermediate_good_producer_appendix}, captures the firm's cost of producing one unit of output, given factor prices and technology. A rise in wages or rental rates increases marginal cost, while higher productivity $A_t$ reduces it.

Intermediate firms set prices subject to Rotemberg-style adjustment costs. The firm chooses a price path to maximize the expected discounted sum of profits, which includes a quadratic penalty for deviating from past prices. 


\begin{equation}
\max_{P_t(j)} \mathbb{E}_t \sum_{s=0}^{\infty} \beta^s \Lambda_{t,t+s} \left[
\underbrace{\frac{P_{t+s}(j)}{P_{t+s}} Y_{t+s}(j)}_{\text{real revenue}} 
- \underbrace{\text{mc}_{t+s} \cdot Y_{t+s}(j)}_{\text{real cost}} 
- \underbrace{\frac{\phi_p}{2} \left( \frac{P_{t+s}(j)}{P_{t+s-1}(j)} - 1 \right)^2 Y_{t+s}}_{\text{price adjustment cost}}
\right]
\label{intermediate_objective}
\end{equation}


In equation \eqref{intermediate_objective}, $\Lambda_{t,t+s} = \beta^s \frac{\lambda_{t+s}}{\lambda_t}$ is the stochastic discount factor, capturing how households value future profits relative to today, where $\lambda_t$ is the marginal utility of consumption. The parameter $\phi_p > 0$ is the magnitude of price adjustment costs - a higher $\phi_p$ implies greater penalties for changing prices rapidly. Finally, $Y_{t+s}(j)$ is the firm-specific demand, which depends on the relative price $\frac{P_{t+s}(j)}{P_{t+s}}$ and aggregate output $Y_{t+s}$, as derived from the CES demand curve in Equation \eqref{demand_curve_final}.



Each intermediate firm $j$ chooses its price path to maximize the expected discounted sum of real profits, taking into account Rotemberg‐style quadratic adjustment costs. In symmetric equilibrium—where $P_t(j)=P_t$ for all $j$ and $\pi_t \equiv P_t/P_{t-1}$—the first‐order condition collapses into the familiar Rotemberg Phillips Curve (see Appendix \ref{intermediate_good_producer_appendix} for the full derivation):
    
\begin{equation}
(\pi_t - 1)\pi_t = \frac{\epsilon}{\phi_p} \left( mc_t - \frac{\epsilon-1}{\epsilon} \right) + \beta \mathbb{E}_t \left[ \frac{\lambda_{t+1}}{\lambda_t} \frac{Y_{t+1}}{Y_t} (\pi_{t+1} - 1)\pi_{t+1} \right]
\label{nkpc}
\end{equation}

\begin{equation}
mc_t = \frac{\text{MC}_t}{P_t}
\label{real_mc}
\end{equation}

In this expression, $mc_t = \tfrac{\mathrm{MC}_t}{P_t}$ denotes the real marginal cost, and $\tfrac{\epsilon-1}{\epsilon}$ is its flexible‐price benchmark. The left‐hand side captures current inflation’s departure from unity, while the first term on the right relates that departure to real marginal cost gaps scaled by the adjustment‐cost parameter $\phi_p$. A larger $\phi_p$ makes prices stickier, damping the response of inflation to cost pressures. The second term brings in expected future inflation, discounted by $\beta$, adjusted for households’ intertemporal marginal‐utility ratio $\lambda_{t+1}/\lambda_t$ and relative output growth $Y_{t+1}/Y_t$. Together, these components link today’s inflation dynamics to both real‐economic conditions and expectations of tomorrow’s price adjustments.



## Government Sector 

Government sector is from @sims2024fiscal's notes. Government chooses spending, (term), exogenously. It finances spending with lump-sum taxes and issues new debt. 



Gov budget constraint (real)
\begin{equation}
g_t + r^B_{t-1} d_{t-1} \leq d_t + \tau_t \label{Gov_Budget}
\end{equation}


With $r^Bt$ is the  ex-post real gross return for bonds held from time $t$. 






To ensure internal consistency, I introduce a simple government sector. The government issues one-period nominal bonds purchased by households, uses tax revenues to finance an exogenous stream of government spending, and services its debt obligations. The government budget constraint equates the sum of nominal spending and interest payments to the sum of new debt issuance and tax revenues. I assume lump-sum taxation and do not model Ricardian equivalence effects explicitly. Bonds held by households are thus assumed to be government-issued, closing the financial side of the model.










## Monetary Authority 

The central bank sets the nominal interest rate $R_t$ according to:  
\begin{equation}
R_t = \rho_R R_{t-1} + (1 - \rho_R) \left[ R_* + \kappa_\pi (\pi_t - \pi_*) + \kappa_y \left( \frac{Y_t - Y_*}{Y_*} \right) \right] + \varepsilon_t^R
\label{taylor_rule}
\end{equation}

To avoid confusion with adjustment costs, $\kappa$ is used instead of the standard $\phi$



 

# Market Clearing and Equilibrium






## Resource Constraint
Goods Market Clearing

\begin{equation}
   Y_t = c_t + i_t + g_t + \frac{\phi_k}{2} \left( \frac{i_t}{K_{t-1}} - \delta \right)^2 K_{t-1} + \frac{\phi_p}{2} (\pi_t - 1)^2 Y_t
   \label{clearing_resource_constraint}
\end{equation}




Fisher Equation 
\begin{align*}
   R_t = \underbrace{r^B_t \cdot \mathbb{E}_t[\pi_{t+1}]}_{\text{ex-ante real rate}} + \text{inflation risk premium}
\end{align*}

assume there is no without risk premium.
\begin{equation}
R_t = r^B_t \cdot \mathbb{E}_t[\pi_{t+1}]  
\end{equation}   
 

## Factor Market Clearing

Labour Market Clearing  
Aggregate labour demand (from intermediate firms) equals aggregate labour supply (from households):
\begin{align}
h_t &= \int_0^1 h_t(j)\,dj
\label{labour_clearing_agg} \\
h_t(j) &= h_t
\quad \forall j
\label{labour_clearing_sym}
\end{align}


Capital Market Clearing
Aggregate capital demand (from intermediate firms) equals aggregate capital supply (from households):
\begin{align}
K_{t-1} &= \int_0^1 K_t(j)\,dj
\label{capital_clearing_agg} \\
K_t(j) &= K_{t-1}
\quad \forall j
\label{capital_clearing_sym}
\end{align}


Aggregate Production Function
In symmetric equilibrium, factor market clearing and the Cobb–Douglas technology imply:
\begin{equation}
Y_t = A_t\,K_{t-1}^{\alpha}\,h_t^{1-\alpha}
\label{aggregate_production}
\end{equation}




## Definition of Equilibrium


A competitive equilibrium is a set of prices () and allocations () such that (i) household and rm optimality conditions all hold, (ii) the rm hires all the labour and capital supplied by the household, (iii) the household and rm budget constraints hold with equality, and (iv) household bond-holdings equal government debt issuance in all periods (i.e. Bt+1 = Dt+1, and we require that Bt = Dt initially), given values and stochastic processes of Gt and At, as well as initial values of government debt and household bond-holdings, which must be equal (e.g. Bt =Dt).


\begin{equation}
b_t = d_t
\label{Bond_market_clear}
\end{equation}
     



































# Exogenous Processes

Government spending, taxes, and technology evolve according to exogenous AR(1) processes.

Real taxes follow Equation \eqref{real_taxes},
\begin{equation}
\tau_t = (1-\rho_\tau)\bar{\tau} + \rho_\tau \tau_{t-1} + \varepsilon_t^\tau 
\label{real_taxes}
\end{equation}
where $\bar{\tau}$ is the steady-state level, $\rho_\tau$ controls persistence, and $\varepsilon_t^\tau$ is a fiscal shock.

Government spending is governed by Equation \eqref{gov_spending},
\begin{equation}
g_t = (1-\rho_g)\bar{g} + \rho_g g_{t-1} + \varepsilon_t^g 
\label{gov_spending}
\end{equation}
with similar dynamics: mean reversion around $\bar{g}$ and shocks $\varepsilon_t^g$.

Technology evolves log-linearly as in Equation \eqref{technology_process},
\begin{equation}
\ln A_t = \rho_a \ln A_{t-1} + \varepsilon_t^a 
\label{technology_process}
\end{equation}
ensuring a unit steady-state level and allowing for persistent TFP shocks.
 

# Steady State






The equilibrium when prices are fully flexible. Therefore set $\phi_p$ to 0 and solve. This should set prices opitimally each period without adjustment costs. Inflation dynamics vanish, simplifying the philips curve. Output and the natrual real rate are purely determined by real economic forces (technology, preferences, and capital accumulation). Equations in this section are derived under appendix \ref{steady_state_app}.

The equation firms are simplifies to:  

\begin{equation}
\max_{P_t(j)} \mathbb{E}_t \sum_{s=0}^{\infty} \beta^s \Lambda_{t,t+s} \left[
\underbrace{\frac{P_{t+s}(j)}{P_{t+s}} Y_{t+s}(j)}_{\text{real revenue}} 
- \underbrace{\frac{\text{MC}_{t+s}}{P_{t+s}} \cdot Y_{t+s}(j)}_{\text{real cost}} 
\right]
\label{intermediate_objective_frictionless}
\end{equation}


Thus we get 
\begin{equation}
mc^*_t = \frac{\epsilon - 1}{\epsilon}
\end{equation}


Real marginal cost \(mc_t\) is constant at $\frac{\epsilon - 1}{\epsilon}$ (inverse markup). The natural level of output \(Y_t^*\) is the output level consistent with this \(mc_t\) in the flexible-price equilibrium. 



\begin{equation}\label{eq:k_ss}
k = \left(\frac{\tfrac{\epsilon-1}{\epsilon}\,\alpha\,A}{\tfrac{1}{\beta} - (1-\delta)}\right)^{\!\frac{1}{1-\alpha}}
\end{equation}

\begin{equation}\label{eq:w_ss}
w^* = \frac{\epsilon-1}{\epsilon}\,(1-\alpha)\,A\,k^\alpha
\end{equation}

\begin{equation}\label{eq:h_ss}
D\,h^* - \bar{g} = \Omega\,(h^*)^{-\gamma/\theta}
\end{equation}

\begin{equation}\label{eq:K_ss}
K^* = k\,h^*
\end{equation}

\begin{equation}\label{eq:Y_ss}
Y^* = A\,k^\alpha\,h^*
\end{equation}

\begin{equation}\label{eq:c_ss}
c^* = D\,h^* - \bar{g}
\end{equation}

\begin{equation}\label{eq:i_ss}
i^* = \delta\,k\,h^*
\end{equation}

\begin{equation}\label{eq:Omega_ss}
\Omega = \frac{1}{1-\eta}
         \left(\frac{(1-\beta\eta)\,w^*}{\chi}\right)^{\!\frac{1}{\theta}}
\end{equation}

\begin{equation}\label{eq:D_ss}
D = A\,k^\alpha - \delta\,k
\end{equation}




Equation \eqref{eq:k_ss} shows the capital-labour ratio. It depends on how productive capital is (adjusted for market power and technology) relative to its return.

Equation \eqref{eq:w_ss} gives the real wage from labour demand. The first term reflects the markup from monopolistic competition, and the rest is just the marginal product of labour.

Equation \eqref{eq:h_ss} pins down hours worked by setting labour supply equal to demand. The left side is output minus depreciation and government spending, and the right side captures the disutility of working, adjusted for consumption habits.

Equation \eqref{eq:K_ss} just says total capital equals capital per worker times hours worked.

Equation \eqref{eq:Y_ss} is the standard production function, written in terms of capital per worker and hours.

Equation \eqref{eq:c_ss} comes from the resource constraint. Output net of depreciation minus government spending gives consumption.

Equation \eqref{eq:i_ss} defines investment as depreciation times the capital stock.

Equation \eqref{eq:Omega_ss} defines the labour supply shifter. It’s a function of wages, habits, and how much people dislike working.

Equation \eqref{eq:D_ss} is net output per worker—output minus depreciation, both on a per-worker basis.








\newpage

# Full set of Conditions

\begin{equation}
c_t + i_t + b_t + m_t \leq r^B_{t-1}b_{t-1} + \dfrac{m_{t-1}}{\pi_t} + w_t h_t + r^k_t K_{t-1} + \Pi^r_t - \tau_t
\tag{\ref{flow_constraint_real}}
\end{equation}

\begin{equation}
K_t
\;=\;
(1 - \delta)\,K_{t-1}
\;+\; i_t
\;-\;\frac{\phi_k}{2}
\left(\frac{i_t}{K_{t-1}} - \delta\right)^{2}
\,K_{t-1}
\tag{\ref{capital_accumulation_real}}
\end{equation}

\begin{equation}
\Pi^r_t = Y_t - r^k_t K_{t-1} - w_t h_t - \dfrac{\phi_p}{2} (\pi_t - 1)^2 Y_t
\tag{\ref{intermediate_firm_profit_real}}
\end{equation}


\begin{equation}\tag{\ref{foc_C}}
\lambda_t = (c_t-\eta c_{t-1})^{-\theta} - \beta,\eta,\mathbb{E}t\bigl[(c{t+1}-\eta c_t)^{-\theta}\bigr]
\end{equation}

\begin{equation}\tag{\ref{foc_h}}
h_t^{\gamma} = \frac{\lambda_t w_t}{\chi}
\end{equation}

\begin{equation}\tag{\ref{foc_B}}
1 = \beta , \mathbb{E}t \left[ \frac{\lambda{t+1}}{\lambda_t} r^B_t \right]
\end{equation}

\begin{equation}\tag{\ref{foc_M}}
\lambda_t = \dfrac{\psi}{m_t} + \beta , \mathbb{E}t \left[ \dfrac{\lambda{t+1}}{\pi_{t+1}} \right]
\end{equation}

\begin{equation}\tag{\ref{foc_I}}
\mu_t = \lambda_t \left( 1 - \phi_k \left( \frac{i_t}{K_{t-1}} - \delta \right) \right)^{-1}
\end{equation}

\begin{equation}\tag{\ref{foc_K}}
1 = \beta , \mathbb{E}t \left[ \frac{\lambda{t+1}}{\mu_t} r^k_{t+1} + \frac{\mu_{t+1}}{\mu_t} \left( (1-\delta) - \frac{\phi_k}{2} \left( \delta^2 - \left( \frac{i_{t+1}}{K_t} \right)^2 \right) \right) \right]
\end{equation}

\begin{equation}
Y_t = A_t K_{t-1}^{\alpha} h_t^{1-\alpha}  \tag{\ref{aggregate_production}}
\end{equation}


\begin{equation}
(\pi_t - 1)\pi_t = \frac{\epsilon}{\phi_p} \left( mc_t - \frac{\epsilon-1}{\epsilon} \right) + \beta \mathbb{E}_t \left[ \frac{\lambda_{t+1}}{\lambda_t} \frac{Y_{t+1}}{Y_t} (\pi_{t+1} - 1)\pi_{t+1} \right]  \tag{\ref{nkpc}}
\end{equation}

\begin{equation}
mc_t = \frac{1}{A_t} \left( \frac{r_t^k}{\alpha} \right)^{\alpha} \left( \frac{w_t}{1-\alpha} \right)^{1-\alpha}  \tag{\ref{marginal_cost}}
\end{equation}




\begin{equation}
g_t + r^B_{t-1} d_{t-1} \leq d_t + \tau_t \tag{\ref{Gov_Budget}}
\end{equation}


\begin{equation}
   Y_t = c_t + i_t + g_t + \frac{\phi_k}{2} \left( \frac{i_t}{K_{t-1}} - \delta \right)^2 K_{t-1} + \frac{\phi_p}{2} (\pi_t - 1)^2 Y_t
   \tag{\ref{clearing_resource_constraint}}
\end{equation}



\begin{equation}
b_t = d_t
\tag{\ref{Bond_market_clear}}
\end{equation}

\begin{equation}
R_t = r^B_t \cdot \mathbb{E}_t[\pi_{t+1}]  
\end{equation}   



\begin{equation}
R_t = \rho_R R_{t-1} + (1 - \rho_R) \left[ R_* + \kappa_\pi (\pi_t - \pi_*) + \kappa_y \left( \frac{Y_t - Y_*}{Y_*} \right) \right] + \varepsilon_t^R
\tag{\ref{taylor_rule}}
\end{equation}


\begin{equation}
\tau_t = (1-\rho_\tau)\bar{\tau} + \rho_\tau \tau_{t-1} + \varepsilon_t^\tau 
\tag{\ref{real_taxes}}
\end{equation}


\begin{equation}
g_t = (1-\rho_g)\bar{g} + \rho_g g_{t-1} + \varepsilon_t^g 
\tag{\ref{gov_spending}}
\end{equation}



\begin{equation}
\ln A_t = \rho_a \ln A_{t-1} + \varepsilon_t^a 
\tag{\ref{technology_process}}
\end{equation}



# Full set of Conditions older
these are the set of conditions i thought i needed when starting to code in dynare
\begin{equation}
\pi_t = \frac{P_t}{P_{t-1}}
\tag{\ref{inflation}}
\end{equation}

\begin{equation}
c_t + i_t + b_t + m_t \leq r^B_{t-1}b_{t-1} + \dfrac{m_{t-1}}{\pi_t} + w_t h_t + r^k_t K_{t-1} + \Pi^r_t - \tau_t
\tag{\ref{flow_constraint_real}}
\end{equation}

\begin{equation}
K_t
\;=\;
(1 - \delta)\,K_{t-1}
\;+\; i_t
\;-\;\frac{\phi_k}{2}
\left(\frac{i_t}{K_{t-1}} - \delta\right)^{2}
\,K_{t-1}
\tag{\ref{capital_accumulation_real}}
\end{equation}

\begin{equation}
\Pi^r_t = Y_t - r^k_t K_{t-1} - w_t h_t - \dfrac{\phi_p}{2} (\pi_t - 1)^2 Y_t
\tag{\ref{intermediate_firm_profit_real}}
\end{equation}

\begin{equation}\tag{\ref{foc_C}}
\lambda_t = (c_t-\eta c_{t-1})^{-\theta} - \beta,\eta,\mathbb{E}t\bigl[(c{t+1}-\eta c_t)^{-\theta}\bigr]
\end{equation}

\begin{equation}\tag{\ref{foc_h}}
h_t^{\gamma} = \frac{\lambda_t w_t}{\chi}
\end{equation}

\begin{equation}\tag{\ref{foc_B}}
1 = \beta , \mathbb{E}t \left[ \frac{\lambda{t+1}}{\lambda_t} r^B_t \right]
\end{equation}

\begin{equation}\tag{\ref{foc_M}}
\lambda_t = \dfrac{\psi}{m_t} + \beta , \mathbb{E}t \left[ \dfrac{\lambda{t+1}}{\pi_{t+1}} \right]
\end{equation}

\begin{equation}\tag{\ref{foc_I}}
\mu_t = \lambda_t \left( 1 - \phi_k \left( \frac{i_t}{K_{t-1}} - \delta \right) \right)^{-1}
\end{equation}

\begin{equation}\tag{\ref{foc_K}}
1 = \beta , \mathbb{E}t \left[ \frac{\lambda{t+1}}{\mu_t} r^k_{t+1} + \frac{\mu_{t+1}}{\mu_t} \left( (1-\delta) - \frac{\phi_k}{2} \left( \delta^2 - \left( \frac{i_{t+1}}{K_t} \right)^2 \right) \right) \right]
\end{equation}


\begin{equation}
Y_t = A_t K_{t-1}^{\alpha} h_t^{1-\alpha}  \tag{\ref{aggregate_production}}
\end{equation}

\begin{equation}
r_t^k = \alpha  mc_t  \frac{Y_t}{K_{t-1}}  \tag{*Derived from \eqref{Capital_Demand_Condition}}
\end{equation}

\begin{equation}
w_t = (1-\alpha)  mc_t  \frac{Y_t}{h_t}  \tag{*Derived from \eqref{Labour_Demand_Condition}}
\end{equation}






\begin{equation}
(\pi_t - 1)\pi_t = \frac{\epsilon}{\phi_p} \left( mc_t - \frac{\epsilon-1}{\epsilon} \right) + \beta \mathbb{E}_t \left[ \frac{\lambda_{t+1}}{\lambda_t} \frac{Y_{t+1}}{Y_t} (\pi_{t+1} - 1)\pi_{t+1} \right]  \tag{\ref{nkpc}}
\end{equation}

\begin{equation}
mc_t = \frac{1}{A_t} \left( \frac{r_t^k}{\alpha} \right)^{\alpha} \left( \frac{w_t}{1-\alpha} \right)^{1-\alpha}  \tag{\ref{marginal_cost}}
\end{equation}




\begin{equation}
g_t + r^B_{t-1} d_{t-1} \leq d_t + \tau_t \tag{\ref{Gov_Budget}}
\end{equation}


\begin{equation}
   Y_t = c_t + i_t + g_t + \frac{\phi_k}{2} \left( \frac{i_t}{K_{t-1}} - \delta \right)^2 K_{t-1} + \frac{\phi_p}{2} (\pi_t - 1)^2 Y_t
   \tag{\ref{clearing_resource_constraint}}
\end{equation}



\begin{equation}
b_t = d_t
\tag{\ref{Bond_market_clear}}
\end{equation}

\begin{equation}
R_t = r^B_t \cdot \mathbb{E}_t[\pi_{t+1}]  
\end{equation}   



\begin{equation}
R_t = \rho_R R_{t-1} + (1 - \rho_R) \left[ R_* + \kappa_\pi (\pi_t - \pi_*) + \kappa_y \left( \frac{Y_t - Y_*}{Y_*} \right) \right] + \varepsilon_t^R
\tag{\ref{taylor_rule}}
\end{equation}



\begin{equation}\tag{\ref{eq:k_ss}}
k = \left(\frac{\tfrac{\epsilon-1}{\epsilon}\,\alpha\,A}{\tfrac{1}{\beta} - (1-\delta)}\right)^{\!\frac{1}{1-\alpha}}
\end{equation}

\begin{equation}\tag{\ref{eq:w_ss}}
w^* = \frac{\epsilon-1}{\epsilon}\,(1-\alpha)\,A\,k^\alpha
\end{equation}

\begin{equation}\tag{\ref{eq:h_ss}}
D\,h^* - \bar{g} = \Omega\,(h^*)^{-\gamma/\theta}
\end{equation}

\begin{equation}\tag{\ref{eq:K_ss}}
K^* = k\,h^*
\end{equation}

\begin{equation}\tag{\ref{eq:Y_ss}}
Y^* = A\,k^\alpha\,h^*
\end{equation}

\begin{equation}\tag{\ref{eq:c_ss}}
c^* = D\,h^* - \bar{g}
\end{equation}

\begin{equation}\tag{\ref{eq:i_ss}}
i^* = \delta\,k\,h^*
\end{equation}

\begin{equation}\tag{\ref{eq:Omega_ss}}
\Omega = \frac{1}{1-\eta}
         \left(\frac{(1-\beta\eta)\,w^*}{\chi}\right)^{\!\frac{1}{\theta}}
\end{equation}

\begin{equation}\tag{\ref{eq:D_ss}}
D = A\,k^\alpha - \delta\,k
\end{equation}


\begin{equation}
\tau_t = (1-\rho_\tau)\bar{\tau} + \rho_\tau \tau_{t-1} + \varepsilon_t^\tau 
\tag{\ref{real_taxes}}
\end{equation}


\begin{equation}
g_t = (1-\rho_g)\bar{g} + \rho_g g_{t-1} + \varepsilon_t^g 
\tag{\ref{gov_spending}}
\end{equation}



\begin{equation}
\ln A_t = \rho_a \ln A_{t-1} + \varepsilon_t^a 
\tag{\ref{technology_process}}
\end{equation}


\newpage





# model



![image](code/rbc_model/rbc_model/graphs/rbc_model_IRF_eps_cropped.png "Title")































































































\newpage
# Appendix

## Households

 
\begin{align*}
  & \text{Define Lagrangian} \\
  & \mathcal{L} = \mathbb{E}_0 \sum_{t=1}^{\infty} \beta^{t-1} \Bigl\{
    \underbrace{\frac{\bigl(c_t-\eta \, c_{t-1}\bigr)^{1-\theta}}{1-\theta}}_{\text{Consumption utility}}
    - \underbrace{\chi\frac{h_t^{1+\gamma}}{1+\gamma}}_{\text{Labour disutility}}
    + \underbrace{\psi\ln\bigl(m_t\bigr)}_{\text{Money utility}} \\
  & \quad\qquad
    + \underbrace{\lambda_t\bigl[\dfrac{R^B_{t-1}b_{t-1}}{\pi_t} + \dfrac{m_{t-1}}{\pi_t} + w_t h_t + r^k_t K_{t-1} + \Pi^r_t - \tau_t -c_t - i_t - b_t - m_t\bigr]}_{\text{Real flow constraint}}
    + \underbrace{\mu_t\bigl[(1 - \delta)\,K_{t-1}
\;+\; i_t
\;-\;\frac{\phi_k}{2}
\left(\frac{i_t}{K_{t-1}} - \delta\right)^{2}
\,K_{t-1} - K_t]}_{\text{Capital accumulation}}
  \Bigr\}
\end{align*}



### First Order Conditions \label{household_FOC}

FOC w.r.t. Consumption

\begin{align*}
  & \frac{\partial \mathcal{L}}{\partial c_t} = 0 \\
  & \quad \bigl[(c_t-\eta c_{t-1})^{-\theta} - \lambda_t\bigr] 
    - \beta\,\eta\,\mathbb{E}_t\bigl[(c_{t+1}-\eta c_t)^{-\theta}\bigr] = 0 \\[6pt]
  & \text{Rearrange} \\
  & \quad \lambda_t = (c_t-\eta c_{t-1})^{-\theta} - \beta\,\eta\,\mathbb{E}_t\bigl[(c_{t+1}-\eta c_t)^{-\theta}\bigr]
\end{align*}

\begin{equation}\label{foc_C_app}
\boxed{\lambda_t = (c_t-\eta c_{t-1})^{-\theta} - \beta\,\eta\,\mathbb{E}_t\bigl[(c_{t+1}-\eta c_t)^{-\theta}\bigr]}
\end{equation}

FOC w.r.t. Labour
\begin{align*}
  & \frac{\partial \mathcal{L}}{\partial h_t} = 0 \\
  & \quad -\chi h_t^{\gamma} + \lambda_t w_t = 0 \\[6pt]
  & \text{Rearrange} \\
  & \quad \lambda_t w_t = \chi h_t^{\gamma}
\end{align*}

\begin{equation}\label{foc_h_app}
\boxed{\lambda_t w_t = \chi h_t^{\gamma}}
\end{equation}



FOC w.r.t. Real Bonds:
\begin{align*}
  & \frac{\partial \mathcal{L}}{\partial b_t} = 0 \\
  & \quad -\beta^{t-1} \lambda_t + \beta^{t} \, \mathbb{E}_t \left[ \lambda_{t+1} \cdot \dfrac{R^B_t}{\pi_{t+1}} \right] = 0 \\[6pt]
  & \text{Divide by } \beta^{t-1} \\
  & \quad -\lambda_t + \beta \, \mathbb{E}_t \left[ \lambda_{t+1} \dfrac{R^B_t}{\pi_{t+1}} \right] = 0
\end{align*}

\begin{equation}\label{foc_B_app}
\boxed{\lambda_t = \beta \, \mathbb{E}_t \left[ \lambda_{t+1} \dfrac{R^B_t}{\pi_{t+1}} \right]}
\end{equation}

FOC w.r.t. Real Money Balances:
\begin{align*}
  & \frac{\partial \mathcal{L}}{\partial m_t} = 0 \\
  & \quad \beta^{t-1} \left[ \dfrac{\psi}{m_t} - \lambda_t \right] + \beta^{t} \, \mathbb{E}_t \left[ \lambda_{t+1} \cdot \dfrac{1}{\pi_{t+1}} \right] = 0 \\[6pt]
  & \text{Divide by } \beta^{t-1} \\
  & \quad \dfrac{\psi}{m_t} - \lambda_t + \beta \, \mathbb{E}_t \left[ \dfrac{\lambda_{t+1}}{\pi_{t+1}} \right] = 0
\end{align*}

\begin{equation}\label{foc_M_app}
\boxed{\dfrac{\psi}{m_t} = \lambda_t - \beta \, \mathbb{E}_t \left[ \dfrac{\lambda_{t+1}}{\pi_{t+1}} \right]}
\end{equation}



FOC w.r.t. Investment:
\begin{align*}
  & \frac{\partial \mathcal{L}}{\partial i_t} = 0 \\
  & \quad \beta^{t-1} \left[ -\lambda_t + \mu_t \cdot \frac{\partial}{\partial i_t} \left( i_t - \frac{\phi_k}{2} \left( \frac{i_t}{K_{t-1}} - \delta \right)^2 K_{t-1} \right) \right] = 0 \\[6pt]
  & \text{Compute derivative:} \\
  & \quad \frac{\partial}{\partial i_t} \left[ i_t - \frac{\phi_k}{2} \left( \frac{i_t}{K_{t-1}} - \delta \right)^2 K_{t-1} \right] = 1 - \phi_k \left( \frac{i_t}{K_{t-1}} - \delta \right) \\[6pt]
  & \text{Substitute and simplify:} \\
  & \quad -\lambda_t + \mu_t \left( 1 - \phi_k \left( \frac{i_t}{K_{t-1}} - \delta \right) \right) = 0
\end{align*}

\begin{equation}\label{foc_I_app}
\boxed{\lambda_t = \mu_t \left( 1 - \phi_k \left( \frac{i_t}{K_{t-1}} - \delta \right) \right)}
\end{equation}

FOC w.r.t. Capital:
\begin{align*}
  & \frac{\partial \mathcal{L}}{\partial K_t} = 0 \\
  & \quad \beta^{t-1} (-\mu_t) + \beta^{t} \, \mathbb{E}_t \left[ \lambda_{t+1} r^k_{t+1} + \mu_{t+1} \cdot \frac{\partial}{\partial K_t} \left( (1-\delta) K_t + i_{t+1} - \frac{\phi_k}{2} \left( \frac{i_{t+1}}{K_t} - \delta \right)^2 K_t \right) \right] = 0 \\[6pt]
  & \text{Compute derivative:} \\
  & \quad \frac{\partial}{\partial K_t} \left[ (1-\delta) K_t - \frac{\phi_k}{2} \left( \frac{i_{t+1}}{K_t} - \delta \right)^2 K_t \right] = (1-\delta) - \frac{\phi_k}{2} \left( \delta^2 - \left( \frac{i_{t+1}}{K_t} \right)^2 \right) \\[6pt]
  & \text{Substitute and simplify:} \\
  & \quad -\mu_t + \beta \, \mathbb{E}_t \left[ \lambda_{t+1} r^k_{t+1} + \mu_{t+1} \left( (1-\delta) - \frac{\phi_k}{2} \left( \delta^2 - \left( \frac{i_{t+1}}{K_t} \right)^2 \right) \right) \right] = 0
\end{align*}

\begin{equation}\label{foc_K_app}
\boxed{\mu_t = \beta \, \mathbb{E}_t \left[ \lambda_{t+1} r^k_{t+1} + \mu_{t+1} \left( (1-\delta) - \frac{\phi_k}{2} \left( \delta^2 - \left( \frac{i_{t+1}}{K_t} \right)^2 \right) \right) \right]}
\end{equation}

\newpage
## Production

### Final Good Producer \label{final_good_producer_appendix}

**Derivation of Intermediate Goods Demand and Aggregate Price Index**  

\begin{align*}  
& \text{Final goods producer's profit:} \\  
& \Pi_t = P_t Y_t - \int_0^1 P_t(j) Y_t(j)  dj \\  
& \text{subject to } Y_t = \left( \int_0^1 Y_t(j)^{\frac{\epsilon-1}{\epsilon}}  dj \right)^{\frac{\epsilon}{\epsilon-1}} \\  
& \\  
& \text{Substitute production function into profit:} \\  
& \Pi_t = P_t \left( \int_0^1 Y_t(j)^{\frac{\epsilon-1}{\epsilon}}  dj \right)^{\frac{\epsilon}{\epsilon-1}} - \int_0^1 P_t(j) Y_t(j)  dj \\  
& \\  
& \text{First-order condition for } Y_t(j): \\  
& \frac{\partial \Pi_t}{\partial Y_t(j)} = P_t \cdot \frac{\epsilon}{\epsilon-1} \left( \int_0^1 Y_t(i)^{\frac{\epsilon-1}{\epsilon}}  di \right)^{\frac{1}{\epsilon-1}} \cdot \frac{\epsilon-1}{\epsilon} Y_t(j)^{-\frac{1}{\epsilon}} - P_t(j) = 0 \\  
& \Rightarrow P_t \cdot Y_t^{\frac{1}{\epsilon}} Y_t(j)^{-\frac{1}{\epsilon}} = P_t(j) \\  
& \\  
& \text{Rearrange to obtain demand curve:} \\  
& Y_t(j) = \left( \frac{P_t}{P_t(j)} \right)^{\epsilon} Y_t \\  
& \\  
& \text{Substitute demand into production function:} \\  
& Y_t = \left( \int_0^1 \left[ \left( \frac{P_t}{P_t(j)} \right)^{\epsilon} Y_t \right]^{\frac{\epsilon-1}{\epsilon}}  dj \right)^{\frac{\epsilon}{\epsilon-1}} \\  
& = Y_t \left( \int_0^1 \left( \frac{P_t}{P_t(j)} \right)^{\epsilon-1}  dj \right)^{\frac{\epsilon}{\epsilon-1}} \\  
& \\
\end{align*}

\begin{align*} 
& \text{Simplify to obtain price index:} \\  
& 1 = \left( \int_0^1 \left( \frac{P_t}{P_t(j)} \right)^{\epsilon-1}  dj \right)^{\frac{\epsilon}{\epsilon-1}} \\  
& \Rightarrow P_t^{1-\epsilon} = \int_0^1 P_t(j)^{1-\epsilon}  dj \\  
& \Rightarrow P_t = \left( \int_0^1 P_t(j)^{1-\epsilon}  dj \right)^{\frac{1}{1-\epsilon}}  
\end{align*}  

\begin{equation}\label{demand_and_price}  
\boxed{  
  \begin{gathered}  
  Y_t(j) = \left( \frac{P_t(j)}{P_t} \right)^{-\epsilon} Y_t \\  
  \\  
  P_t = \left( \int_0^1 P_t(j)^{1-\epsilon}  dj \right)^{\frac{1}{1-\epsilon}}  
  \end{gathered}  
}  
\end{equation}  





### Intermediate Goods Producers \label{intermediate_good_producer_appendix}

\begin{align*}
& \text{Cost minimization for intermediate firm } j: \\
& \min_{K_t(j), h_t(j)} \left\{ r_t^k K_t(j) + w_t h_t(j) \right\} \\
& \text{subject to } Y_t(j) = A_t K_t(j)^{\alpha} h_t(j)^{1-\alpha} \\
& \\
& \text{Lagrangian:} \\
& \mathcal{L} = r_t^k K_t(j) + w_t h_t(j) + \lambda_t \left[ A_t K_t(j)^{\alpha} h_t(j)^{1-\alpha} - Y_t(j) \right] \\
& \\
& \text{First-order conditions:} \\
& \frac{\partial \mathcal{L}}{\partial K_t(j)} = 0: \quad r_t^k = \lambda_t \alpha A_t K_t(j)^{\alpha-1} h_t(j)^{1-\alpha} \\
& \frac{\partial \mathcal{L}}{\partial h_t(j)} = 0: \quad w_t = \lambda_t (1-\alpha) A_t K_t(j)^{\alpha} h_t(j)^{-\alpha} \\
& \\
& \text{Rearrange FOCs:} \\
& \lambda_t = \frac{r_t^k}{\alpha} \left( \frac{K_t(j)}{h_t(j)} \right)^{1-\alpha} \frac{1}{A_t}, \quad 
\lambda_t = \frac{w_t}{1-\alpha} \left( \frac{K_t(j)}{h_t(j)} \right)^{\alpha} \frac{1}{A_t} \\
& \\
& \text{Equate expressions:} \\
& \frac{r_t^k}{\alpha} \left( \frac{K_t(j)}{h_t(j)} \right)^{-\alpha} = \frac{w_t}{1-\alpha} \left( \frac{K_t(j)}{h_t(j)} \right)^{1-\alpha} \\
& \Rightarrow \frac{K_t(j)}{h_t(j)} = \frac{\alpha}{1-\alpha} \frac{w_t}{r_t^k} \\
& \\
& \text{Substitute into capital FOC:} \\
& \lambda_t = \frac{r_t^k}{\alpha A_t} \left( \frac{\alpha}{1-\alpha} \frac{w_t}{r_t^k} \right)^{\alpha-1} \\
& = \frac{1}{A_t} \left( \frac{r_t^k}{\alpha} \right)^{\alpha} \left( \frac{w_t}{1-\alpha} \right)^{1-\alpha}
\end{align*}

\begin{equation}\label{marginal_cost_appendix}
\boxed{mc_t = \dfrac{1}{A_t} \left( \dfrac{r_t^k}{\alpha} \right)^{\alpha} \left( \dfrac{w_t}{1-\alpha} \right)^{1-\alpha}}
\end{equation}



\begin{align*}
& \text{Intermediate‐goods producer’s problem:} \\
& \max_{P_t(j)} \;\mathbb{E}_t \sum_{s=0}^{\infty} \Lambda_{t,t+s}
  \Bigl[
    \bigl(\tfrac{P_{t+s}(j)}{P_{t+s}}\bigr)^{1-\epsilon} Y_{t+s}
    - mc_{t+s}\,\bigl(\tfrac{P_{t+s}(j)}{P_{t+s}}\bigr)^{-\epsilon} Y_{t+s}
    - \tfrac{\phi_p}{2}\bigl(\tfrac{P_{t+s}(j)}{P_{t+s-1}(j)} - 1\bigr)^2 Y_{t+s}
  \Bigr] \\
& \text{subject to} \quad Y_t(j) = \bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-\epsilon} Y_t
\\[1.5ex]
& \text{First‐Order Condition w.r.t. }P_t(j): \\
& \mathbb{E}_t\Bigl[
    \frac{\partial \Pi_t(j)}{\partial P_t(j)}
    + \beta\,\Lambda_{t,t+1}
      \frac{\partial \Pi_{t+1}(j)}{\partial P_t(j)}
  \Bigr] = 0
\\[1ex]
& \frac{\partial \Pi_t}{\partial P_t(j)}
  = (1-\epsilon)\bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-\epsilon}\tfrac{Y_t}{P_t}
    + \epsilon\,mc_t\bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-\epsilon-1}\tfrac{Y_t}{P_t}
    - \phi_p\bigl(\tfrac{P_t(j)}{P_{t-1}(j)}-1\bigr)\tfrac{Y_t}{P_{t-1}(j)}
\\[1ex]
& \frac{\partial \Pi_{t+1}}{\partial P_t(j)}
  = \phi_p\bigl(\tfrac{P_{t+1}(j)}{P_t(j)}-1\bigr)\,\tfrac{P_{t+1}(j)}{P_t(j)^2}\,Y_{t+1}
\\[2ex]
& \text{Impose symmetry: }P_t(j)=P_t,\;Y_t(j)=Y_t,\;\pi_t=\tfrac{P_t}{P_{t-1}}.\\
& (1-\epsilon)+\epsilon\,mc_t = \epsilon\bigl(mc_t-\tfrac{\epsilon-1}{\epsilon}\bigr),\quad
  \tfrac{P_t(j)}{P_{t-1}(j)}=\pi_t,\;\tfrac{P_{t+1}(j)}{P_t(j)}=\pi_{t+1}
\\[1ex]
& 0 = \epsilon\bigl(mc_t-\tfrac{\epsilon-1}{\epsilon}\bigr)
      - \phi_p\,(\pi_t-1)\,\pi_t
      + \beta\,\mathbb{E}_t\Bigl[
          \Lambda_{t,t+1}\,\phi_p\,(\pi_{t+1}-1)\,\pi_{t+1}
          \,\tfrac{Y_{t+1}P_t}{Y_tP_{t+1}}
        \Bigr]
\\[1ex]
\end{align*}


Noting \(\Lambda_{t,t+1}=\beta\,\tfrac{\lambda_{t+1}}{\lambda_t}\) and \(P_{t+1}/P_t=\pi_{t+1}\), the bracket simplifies to \(\beta\,\tfrac{\lambda_{t+1}}{\lambda_t}\,\tfrac{Y_{t+1}}{Y_t}\).

\begin{equation}\label{rotemberg_FOC}
\boxed{
  0 = \epsilon\Bigl(mc_t - \tfrac{\epsilon-1}{\epsilon}\Bigr)
      - \phi_p\,(\pi_t - 1)\,\pi_t
      + \beta\,\mathbb{E}_t\!
        \Bigl[
          \tfrac{\lambda_{t+1}}{\lambda_t}\,
          \phi_p\,(\pi_{t+1}-1)\,\pi_{t+1}\,
          \tfrac{Y_{t+1}}{Y_t}
        \Bigr]
}
\end{equation}


























## Steady State \label{steady_state_app}

\begin{align*}
\max_{P_t(j)}\;&(P_t(j)/P_t)^{1-\epsilon}Y_t \;-\; mc_t\,(P_t(j)/P_t)^{-\epsilon}Y_t \\[6pt]
\frac{\partial}{\partial P_t(j)}:\;&(1-\epsilon)(P_t(j)/P_t)^{-\epsilon}\frac{Y_t}{P_t}
\;+\;\epsilon\,mc_t\,(P_t(j)/P_t)^{-\epsilon-1}\frac{Y_t}{P_t}=0 \\[6pt]
\Rightarrow\;&(1-\epsilon)+\epsilon\,mc_t\,(P_t(j)/P_t)^{-1}=0 \\[4pt]
\Rightarrow\;&P_t(j)/P_t=\frac{\epsilon}{\epsilon-1}\;mc_t
\end{align*}

In equilibrium $P_t(j)=P_t$, so
\[
1=\frac{\epsilon}{\epsilon-1}\,mc_t
\]
\begin{equation}\label{eq:mc}
mc^*_t=\frac{\epsilon-1}{\epsilon}
\end{equation}



### Derivation of Flexible-Price Steady-State Values


\begin{align*}
& \text{Factor Prices and Technology Link} \\
& mc^* = \frac{\epsilon - 1}{\epsilon} \\
& mc^* = \frac{1}{A} \left( \frac{r^{k,*}}{\alpha} \right)^{\alpha}
            \left( \frac{w^*}{1-\alpha} \right)^{1-\alpha} \\
& \text{Substitute to get} \\
& \frac{\epsilon - 1}{\epsilon}
  = \frac{1}{A} \left( \frac{r^{k,*}}{\alpha} \right)^{\alpha}
    \left( \frac{w^*}{1-\alpha} \right)^{1-\alpha}
\end{align*}

\begin{align*}
& \text{Steady-State Real Rates} \\
& r^{B,*} = \frac{1}{\beta} \\
& r^{k,*} = \frac{1}{\beta} - (1 - \delta)
\end{align*}

\begin{align*}
& \text{Solve for Wage } w^* \\
& \frac{K^*}{h^*}
  = \Bigl(\tfrac{mc^*\,\alpha\,A}{r^{k,*}}\Bigr)^{\!\frac{1}{1-\alpha}} \\
& w^* = mc^*(1-\alpha)\,A \Bigl(\tfrac{K^*}{h^*}\Bigr)^{\!\alpha} \\
& \text{Substitute to get} \\
& w^* = \frac{\epsilon-1}{\epsilon}\,(1-\alpha)\,A
         \Bigl(\tfrac{\tfrac{\epsilon-1}{\epsilon}\,\alpha\,A}
                     {\tfrac{1}{\beta} - (1-\delta)}\Bigr)^{\!\frac{\alpha}{1-\alpha}}
\end{align*}

\begin{align*}
& \text{labour Supply with Habit Formation} \\
& \lambda^* = [c^*(1-\eta)]^{-\theta}(1 - \beta\eta) \\
& [c^*(1-\eta)]^{-\theta}(1 - \beta\eta)\,w^* = \chi\,(h^*)^\gamma
\end{align*}

\begin{align*}
& \text{Resource Constraints} \\
& i^* = \delta K^* \\
& Y^* = c^* + i^* + \bar{g} = c^* + \delta K^* + \bar{g}
\end{align*}

\begin{align*}
& \text{Solve for Steady-State Values} \\
& Y^* = A (K^*)^\alpha (h^*)^{1-\alpha} \\
& k \equiv \tfrac{K^*}{h^*}
  = \Bigl(\tfrac{\tfrac{\epsilon-1}{\epsilon}\,\alpha\,A}
               {\tfrac{1}{\beta} - (1-\delta)}\Bigr)^{\!\frac{1}{1-\alpha}} \\
& Y^* = A k^\alpha h^* \\
& A k^\alpha h^* = \frac{1}{1-\eta}
                   \Bigl(\tfrac{(1-\beta\eta)\,w^*}{\chi}\Bigr)^{\!\frac{1}{\theta}}
                   (h^*)^{-\frac{\gamma}{\theta}}
                 + \delta k h^* + \bar{g}
\end{align*}

\begin{align*}
& \Omega \equiv \frac{1}{1-\eta}
                 \Bigl(\tfrac{(1-\beta\eta)\,w^*}{\chi}\Bigr)^{\!\frac{1}{\theta}}, 
\quad
D \equiv A k^\alpha - \delta k \\
& D\,h^* - \bar{g} = \Omega\,(h^*)^{-\frac{\gamma}{\theta}}
\end{align*}

\begin{align*}
& \text{ Monetary Policy Steady State} \\
& \pi^* = \pi_* \\
& R^* = r^{B,*}\,\pi^* = \frac{\pi_*}{\beta}
\end{align*}

\begin{equation}\label{closed_form_ss}
\boxed{
  \begin{gathered}
    k = \Bigl(\tfrac{\tfrac{\epsilon-1}{\epsilon}\,\alpha\,A}
                  {\tfrac{1}{\beta} - (1-\delta)}\Bigr)^{\!\frac{1}{1-\alpha}},
    \quad
    w^* = \tfrac{\epsilon-1}{\epsilon}(1-\alpha)\,A\,k^\alpha, \\[6pt]
    h^*:\; D\,h^* - \bar{g} = \Omega\,(h^*)^{-\gamma/\theta}, 
    \quad
    K^* = k\,h^*, 
    \\[4pt]
    Y^* = A\,k^\alpha\,h^*, 
    \quad 
    c^* = D\,h^* - \bar{g}, 
    \quad 
    i^* = \delta\,k\,h^*,
    \\[4pt]
    \Omega = \tfrac{1}{1-\eta}
             \Bigl(\tfrac{(1-\beta\eta)\,w^*}{\chi}\Bigr)^{\!\tfrac{1}{\theta}},
    \quad
    D = A\,k^\alpha - \delta\,k
  \end{gathered}
}
\end{equation}






\newpage




# References




```{r model from class,eval=FALSE}


# Note that this is my original MOD file that we used in class, it is here as a means to check if my code actually works in terms of running dynare in R (it does, and i will keep it here as a backup to check in future)
dynareCodes='%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% RBC model with labour and Log Utility 
% Based on image equations (10)–(17)
% Corrected for B&K conditions (loglinear TFP)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

var C               // Consumption
    I               // Investment
    Y               // Output
    K               // Capital stock
    R               // Return on Capital
    W               // Wage
    H               // Hours worked
    A;              // Productivity level

varexo eps;         // TFP shock

parameters beta alpha delta rho chi;

beta  = 0.99;       // Discount factor
alpha = 0.33;       // Capital share
delta = 0.025;      // Depreciation rate
rho   = 0.95;       // TFP shock persistence
chi   = 2.24;       // labour disutility parameter

model;
    // (10) Euler equation
    1/C = beta * (1/C(+1)) * (R(+1) + 1 - delta);

    // (11) labour-leisure trade-off
    (1/C) * W = chi / (1 - H);

    // (12) Resource constraint
    C + I = Y;

    // (13) Return on capital
    R = alpha * Y / K;

    // (14) Wage equation
    W = (1 - alpha) * Y / H;

    // (15) Capital accumulation
    I = K - (1 - delta) * K(-1);

    // (16) Cobb-Douglas production
    Y = A * K^alpha * H^(1 - alpha);

    // (17) Log TFP process
    log(A) = rho * log(A(-1)) + eps;
end;

initval;
    A = 1;
    K = ((alpha * beta / (1 - beta * (1 - delta)))^(1/(1 - alpha)));
    H = 0.33;
    Y = A * K^alpha * H^(1 - alpha);
    I = delta * K;
    C = Y - I;
    R = alpha * Y / K;
    W = (1 - alpha) * Y / H;
end;


steady;
check;
resid;

shocks;
    var eps = 0.01^2; // 1% standard deviation TFP shock
 end;

stoch_simul(order=1, irf=40, hp_filter=1600, loglinear,graph_format=fig) Y C I K H W A R;'

```


```{r, eval=FALSE}

# again this is old code only used for dynostic checking
# 1. Write the .mod file into the code/ folder
write_mod(
  code  = dynareCodes,
  model = "code/rbc_model"
)

# 2. Run Dynare and import the log
rbc_results <- run_dynare(
  code       = dynareCodes,
  model      = "code/rbc_model",
  import_log = TRUE
)
```
