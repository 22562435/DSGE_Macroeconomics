---
# IMPORTANT: Change settings here, but DO NOT change the spacing.
# Remove comments and add values where applicable.
# The descriptions below should be self-explanatory

title: "Macroeconomics Assignment"
#subtitle: "This will appear as Right Header"

documentclass: "elsarticle"

# --------- Thesis title (Optional - set to FALSE by default).
# You can move the details below around as you please.
Thesis_FP: FALSE
# Entry1: "An unbelievable study with a title spanning multiple lines."
# Entry2: "\\textbf{Some Guy}" # textbf for bold
# Entry3: "A thesis submitted toward the degree of Doctor of Philosophy"
# Uni_Logo: Tex/Logo.png # Place a logo in the indicated location (from your root, e.g. defaults to ~/Tex/Logo.png) and uncomment this line. Leave uncommented for no image
# Logo_width: 0.3 # If using a logo - use this to set width (size) of image
# Entry4: "Under the supervision of: \\vfill Prof. Joe Smith and Dr. Frank Smith"
# Entry5: "Stellenbosch University"
# Entry6: April 2020
# Entry7:
# Entry8:

# --------- Front Page
# Comment: ----- Follow this pattern for up to 5 authors
AddTitle: TRUE # Use FALSE when submitting to peer reviewed platform. This will remove author names.
Author1: "Liam Andrew Beattie"  # First Author - note the thanks message displayed as an italic footnote of first page.
Ref1: "Macroeconomics 871, Stellenbosch University, South Africa" # First Author's Affiliation
Email1: "22562435\\@sun.ac.za"

# ----- Manage headers and footers:
#BottomLFooter: $Title$
#BottomCFooter:
#TopLHeader: \leftmark # Adds section name at topleft. Remove comment to add it.
BottomRFooter: "\\footnotesize Page \\thepage" # Add a '#' before this line to remove footer.
addtoprule: TRUE
addfootrule: TRUE               # Use if footers added. Add '#' to remove line.

# --------- page margins:
margin: 2.3 # Sides
bottom: 2 # bottom
top: 2.5 # Top
HardSet_layout: TRUE # Hard-set the spacing of words in your document. This will stop LaTeX squashing text to fit on pages, e.g.
# This is done by hard-setting the spacing dimensions. Set to FALSE if you want LaTeX to optimize this for your paper.

# --------- Line numbers
linenumbers: FALSE # Used when submitting to journal

# ---------- References settings:
# You can download cls format here: https://www.zotero.org/ - simply search for your institution. You can also edit and save cls formats here: https://editor.citationstyles.org/about/
# Hit download, store it in Tex/ folder, and change reference below - easy.
bibliography: Tex/ref.bib       # Do not edit: Keep this naming convention and location.
csl: Tex/harvard-stellenbosch-university.csl # referencing format used.
# By default, the bibliography only displays the cited references. If you want to change this, you can comment out one of the following:
#nocite: '@*' # Add all items in bibliography, whether cited or not
# nocite: |  # add specific references that aren't cited
#  @grinold2000
#  @Someoneelse2010

# ---------- General:
RemovePreprintSubmittedTo: TRUE  # Removes the 'preprint submitted to...' at bottom of titlepage
Journal: "Journal of Finance"   # Journal that the paper will be submitting to, if RemovePreprintSubmittedTo is set to TRUE.
toc: FALSE                       # Add a table of contents
numbersections: TRUE             # Should sections (and thus figures and tables) be numbered?
fontsize: 11pt                  # Set fontsize
linestretch: 1.2                # Set distance between lines.
link-citations: TRUE            # This creates dynamic links to the papers in reference list.

### Adding additional latex packages:
header-includes:
  - \usepackage{sectsty}
  - \sectionfont{\bfseries\large}  # Makes section (heading #) bold and large
  - \subsectionfont{\bfseries\normalsize}  # Makes subsection (##) bold and normal size


output:
  pdf_document:
    keep_tex: TRUE
    template: Tex/TexDefault.txt
    fig_width: 3.5 # Adjust default figure sizes. This can also be done in the chunks of the text.
    fig_height: 3.5
abstract: |
  Almost an abstract
---

<!-- First: Set your default preferences for chunk options: -->

<!-- If you want a chunk's code to be printed, set echo = TRUE. message = FALSE stops R printing ugly package loading details in your final paper too. I also suggest setting warning = FALSE and checking for warnings in R, else you might find ugly warnings in your paper. -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width = 6, fig.height = 5, fig.pos="H", fig.pos = 'H')
# Note: Include = FALSE implies the code is executed, but not printed in your pdf.
# warning and message = FALSE implies ugly messages and warnings are removed from your pdf.
# These should be picked up when you execute the command chunks (code sections below) in your rmd, not printed in your paper!

# Lets load in example data, and see how this can be stored and later called from your 'data' folder.
if(!require("tidyverse")) install.packages("tidyverse")
library(tidyverse)
library(DynareR)
```



<!-- ############################## -->
<!-- # Start Writing here: -->
<!-- ############################## -->

```{r dynare-code-mod}

#Please note that this is not the correct mod file, but here for example purposes based on what i have currently 
dynareCodes_NKM <- "// Model: DSGE with Capital, Money, and Sticky Prices

// Endogenous Variables
var pi c i b m K h Y g tau A mc w r_k R lambda_real mu;
varexo eR e_tau e_g e_a;

// Parameters
parameters beta eta theta chi gamma psi delta phi_k alpha epsilon phi_p 
           rho_R phi_pi phi_y rho_tau rho_g rho_a 
           pi_ss R_ss Y_ss tau_ss g_ss A_ss;

// Parameter Calibration (example values - adjust as needed)
beta = 0.99;       // Discount factor
eta = 0.5;         // Habit persistence
theta = 2;         // Risk aversion
chi = 1;           // Labor disutility weight
gamma = 1.5;       // Inverse Frisch elasticity
psi = 0.01;        // Money utility weight
delta = 0.025;     // Depreciation rate
phi_k = 4;         // Investment adjustment cost
alpha = 0.33;      // Capital share
epsilon = 6;       // Elasticity of substitution
phi_p = 20;        // Price adjustment cost
rho_R = 0.8;       // Taylor rule inertia
phi_pi = 1.5;      // Inflation response
phi_y = 0.125;     // Output response
rho_tau = 0.9;     // Tax persistence
rho_g = 0.9;       // Gov spending persistence
rho_a = 0.9;       // Tech persistence
pi_ss = 1.0;       // Steady-state inflation
Y_ss = 1.0;        // Steady-state output (normalized)
tau_ss = 0.2;      // Steady-state taxes
g_ss = 0.2;        // Steady-state gov spending
A_ss = 1.0;        // Steady-state technology

// Steady-State Calculations
R_ss = pi_ss / beta;                   // Nominal rate (eq 26)
r_k_ss = (1/beta) - (1 - delta);       // Real return on capital (eq 27)

model;
  // Inflation Definition (eq 1)
  pi = P / P(-1);
  // Capital Accumulation (eq 3)
  K = (1 - delta)*K(-1) + i - (phi_k/2)*((i/K(-1)) - delta)^2 * K(-1);
  // Aggregate Production (eq 11)
  Y = A * K(-1)^alpha * h^(1 - alpha);
  // Real Marginal Cost (eq 16)
  mc = (1/A) * (r_k/alpha)^alpha * (w/(1 - alpha))^(1 - alpha);
  // New Keynesian Phillips Curve (eq 17)
  (pi - 1)*pi = (epsilon/phi_p) * (mc - (epsilon - 1)/epsilon) 
                + beta * (lambda_real(1)/lambda_real) * (Y(1)/Y) * (pi(1) - 1);
  // Government Budget Constraint (eq 18, real)
  g + R(-1)*b(-1)/pi = b + tau;
  // Taylor Rule (eq 21)
  R = rho_R*R(-1) + (1 - rho_R)*(R_ss + phi_pi*(pi - pi_ss) + phi_y*((Y - Y_ss)/Y_ss)) + eR;
  // Resource Constraint (eq 22)
  Y = c + i + g + (phi_k/2)*((i/K(-1)) - delta)^2 * K(-1) + (phi_p/2)*(pi - 1)^2 * Y;
  // Tax Process (eq 23)
  tau = (1 - rho_tau)*tau_ss + rho_tau*tau(-1) + e_tau;
  // Government Spending (eq 24)
  g = (1 - rho_g)*g_ss + rho_g*g(-1) + e_g;
  // Technology Process (eq 25)
  log(A) = rho_a*log(A(-1)) + e_a;
  // FOC Consumption (eq 4)
  lambda_real = (c - eta*c(-1))^(-theta) - beta*eta*((c(1) - eta*c)^(-theta));
  // FOC Labor (eq 5)
  lambda_real * w = chi * h^gamma;
  // FOC Money (eq 6)
  psi / m = lambda_real - beta*(lambda_real(1)/pi(1));
  // FOC Bonds (eq 7 + 20)
  lambda_real = beta*(lambda_real(1)/pi(1)) * R;
  // FOC Investment (eq 8)
  lambda_real = mu * (1 - phi_k*((i/K(-1)) - delta));
  // FOC Capital (eq 9)
  mu = beta * (lambda_real(1)*r_k(1) 
        + mu(1) * ((1 - delta) + (phi_k/2)*((i(1)/K)^2 - delta^2)));
end;

// Steady-State Initialization (example - solve numerically)
initval;
  pi = pi_ss;
  R = R_ss;
  r_k = r_k_ss;
  Y = Y_ss;
  c = Y_ss * 0.6;  // Adjust to satisfy constraints
  i = Y_ss * 0.2;
  g = g_ss;
  tau = tau_ss;
  A = A_ss;
  K = (alpha * Y_ss * mc / r_k)^(1/(1 - alpha));  // From prod. function
  h = ((1 - alpha) * Y_ss * mc / w)^(1/alpha) * K; 
  w = (1 - alpha) * mc * (K/h)^alpha * A; 
  mc = (epsilon - 1)/epsilon;  // Zero inflation SS
  b = 0.6;  // Debt/GDP ratio
  m = (psi * c^theta) / (1 - beta/pi_ss);  // Money demand
  lambda_real = (c*(1 - eta))^(-theta);  // Habit-adjusted MU
  mu = lambda_real / (1 - phi_k*(delta - delta));  // Adj. cost=0 in SS
end;

steady;  // Solve for steady state

// Shocks
shocks;
  var eR = 0.01^2;       // Monetary policy shock
  var e_tau = 0.01^2;    // Tax shock
  var e_g = 0.01^2;      // Government spending shock
  var e_a = 0.01^2;      // Technology shock
end;

// Solution
stoch_simul(order=1, irf=20);




"

# will set eval to true when happy with MOD file
write_mod(
  code  = dynareCodes_NKM,
  model = "code/nkm_model"
)

```



I have used an R package from @{Mati2019} and should give credit. This allowed me to code everything in R while still using Dynare. 


# Model Specification


\begin{equation}
\pi_t = \frac{P_t}{P_{t-1}}
\label{inflation}
\end{equation}


\begin{equation}
c_t = \frac{C_t}{P_t}, 
\quad i_t = \frac{I_t}{P_t}, 
\quad g_t = \frac{G_t}{P_t},
\quad b_t = \frac{B_t}{P_t}
\label{real_conversions}
\end{equation}



Above could note be a heading on itself. Just a paragraph that it is a core rbc foundations and what that means. 

As with \eqref{real_conversions}, it is a general rule that capital letters denote nominal amounts and lowercase denote real values, however to follow convention $K_t$ denotes real capital.



Mainly adding capital to  @sims2024newkeynesian, while also introducing adjustment costs from @sims2024rbc . Rotemberg prices was used while gleeming insights from @ecbwp770 .


## Households 





\begin{equation}
\max_{\{C_t,\,h_t,\,M_t,\,B_t,\,K_t,\,I_t\}}
\mathbb{E}_0 \sum_{t=1}^{\infty} \beta^{t-1}
\left[
\frac{\Bigl(\frac{C_t}{P_t} - \eta\,\frac{C_{t-1}}{P_{t-1}}\Bigr)^{1-\theta}}{1-\theta}
\;-\;\chi\,\frac{h_t^{1+\gamma}}{1+\gamma}
\;+\;\psi\,\ln\!\Bigl(\frac{M_t}{P_t}\Bigr)
\right]
\label{lifetime_utility_nominal}
\end{equation}


\begin{equation}
C_t \;+\; I_t \;+\; B_t \;+\; M_t
\;\le\;
R^B_{\,t-1}\,B_{t-1}
\;+\; M_{t-1}
\;+\; W_t\,h_t
\;+\; R^k_t\,K_{t-1}
\;+\; \Pi_t
\;-\; P_t\,\tau_t
\label{flow_constraint_nominal}
\end{equation}



\begin{equation}
K_t
\;=\;
(1 - \delta)\,K_{t-1}
\;+\; i_t
\;-\;\frac{\phi_k}{2}
\left(\frac{i_t}{K_{t-1}} - \delta\right)^{2}
\,K_{t-1}
\label{capital_accumulation_real}
\end{equation}

Households are the owners of all intermediate‐goods firms and receive the aggregate profits as lump‐sum income transfers each period.  Denoting aggregate profits by $\Pi_t$, we can write
\begin{equation}
\Pi_t \;=\; P_t\,Y_t \;-\; R^k_t\,K_{t-1} \;-\; W_t\,h_t \;-\;\tfrac{\phi_p}{2}\,(\pi_t - 1)^2\,P_t\,Y_t
\label{intermediate_firm_profit}
\end{equation}

where $P_tY_t$ is nominal revenue, $R^k_t K_{t-1}$ and $W_t h_t$ are total nominal factor payments, and the last term captures Rotemberg‐style price adjustment costs in nominal terms.




Households maximize expected lifetime utility over consumption and labour supply, taking all after-tax income—wages, rental income, bond returns, and profits—as given. In particular, we treat firm profits $\Pi_t$ as a lump‐sum transfer from firms that enters the budget constraint passively; households do not choose or time their utility over firm profits, nor do they form expectations about future payouts.  

From which we can derive the following first order conditions, found in full form in Appendix \ref{household_FOC}:

\begin{equation}\label{foc_C}
{
  \lambda_t P_t = (c_t-\eta c_{t-1})^{-\theta} - \beta\eta\,\mathbb{E}_t\bigl[(c_{t+1}-\eta c_t)^{-\theta}\bigr]
}
\end{equation}

\begin{equation}\label{foc_h}
{\lambda_t W_t = \chi h_t^{\gamma}}
\end{equation}

\begin{equation}\label{foc_M}
{\frac{\psi}{M_t} = \lambda_t - \beta\,\mathbb{E}_t[\lambda_{t+1}]}
\end{equation}

\begin{equation}\label{foc_B}
{\lambda_t = \beta\,\mathbb{E}_t[\lambda_{t+1}R^B_t]}
\end{equation}


\begin{equation}\label{foc_I}
{\lambda_t P_t = \mu_t 
  \Bigl[ 1 - \phi_k\bigl( \tfrac{I_t}{P_t K_{t-1}} - \delta \bigr) \Bigr]}
\end{equation}

\begin{equation}\label{foc_K}
{\mu_t = \beta\,\mathbb{E}_t\Bigl[
        \lambda_{t+1}R^k_{t+1}
      + \mu_{t+1}\Bigl(
          (1-\delta)
        + \tfrac{\phi_k}{2}\Bigl(
            \bigl(\tfrac{I_{t+1}}{P_{t+1}K_t}\bigr)^2
          - \delta^2
          \Bigr)
        \Bigr)
      \Bigr]}  
\end{equation}

\newpage


## Production 


This model departs from standard RBC frameworks by introducing monopolistic competition and nominal rigidities. This is achieved through two layers of firms. The first being a perfectly competitive final goods producers, who aggregate intermediate goods, and the second being a monopolistically competitive intermediate goods producers with price-setting power.  This two-tiered structure captures core New Keynesian dynamics, such as price stickiness and strategic pricing, while retaining analytical tractability.


### Final Goods Producer

The final goods firm combines differentiated inputs \(Y_t(j)\) into final output \(Y_t\) using a CES aggregator:  

\begin{equation}  
Y_t = \left( \int_0^1 Y_t(j)^{\frac{\epsilon-1}{\epsilon}}  dj \right)^{\frac{\epsilon}{\epsilon-1}}, \quad \epsilon > 1  
\label{ces_production}  
\end{equation}  

Where \(\epsilon\) captures the elasticity of substitution between varieties: the higher it is, the more easily final goods producers can substitute across inputs. Conversely, a lower \(\epsilon\) implies that intermediate producers face less competition and enjoy greater market power.

Given the CES aggregator in Equation \eqref{ces_production}, the final goods producer chooses input varieties to minimize the cost of delivering one unit of output. The resulting demand and pricing relationships, derived in Appendix \ref{final_good_producer_appendix}, are:

  
\begin{equation}  
Y_t(j) = \left( \frac{P_t(j)}{P_t} \right)^{-\epsilon} Y_t  
\label{demand_curve_final}  
\end{equation}  

  
\begin{equation}  
P_t = \left( \int_0^1 P_t(j)^{1-\epsilon}  dj \right)^{\frac{1}{1-\epsilon}}  
\label{aggregate_price_index}  
\end{equation}
  
  
Equation \eqref{demand_curve_final} shows that more expensive varieties are purchased in smaller quantities, while Equation \eqref{aggregate_price_index} reflects the minimum cost of assembling one unit of final output given prevailing input prices.



### Intermediate Goods Producers




Each intermediate firm \(j\) produces with identical Cobb-Douglas technology:  
\begin{equation}
Y_t(j) = A_t K_t(j)^{\alpha} h_t(j)^{1-\alpha}
\label{intermediate_production}
\end{equation}

Cost minimization yields capital and labour demand conditions as well as the marginal cost:

\begin{equation}
R_t^k = MC_t \alpha A_t K_t(j)^{\alpha-1} h_t(j)^{1-\alpha}
\label{Capital_Demand_Condition}
\end{equation}

\begin{equation}
W_t = MC_t (1-\alpha) A_t K_t(j)^{\alpha} h_t(j)^{-\alpha}
\label{Labour_Demand_Condition}
\end{equation}


\begin{equation}
\text{MC}_t = \frac{1}{A_t} \left( \frac{R_t^k}{\alpha} \right)^{\alpha} \left( \frac{W_t}{1-\alpha} \right)^{1-\alpha}
\label{marginal_cost}
\end{equation}


Equation \eqref{marginal_cost}, which is derived in Appendix \ref{intermediate_good_producer_appendix}, captures the firm's cost of producing one unit of output, given factor prices and technology. A rise in wages or rental rates increases marginal cost, while higher productivity $A_t$ reduces it.

Intermediate firms set prices subject to Rotemberg-style adjustment costs. The firm chooses a price path to maximize the expected discounted sum of profits, which includes a quadratic penalty for deviating from past prices. 


\begin{equation}
\max_{P_t(j)} \mathbb{E}_t \sum_{s=0}^{\infty} \beta^s \Lambda_{t,t+s} \left[
\underbrace{\frac{P_{t+s}(j)}{P_{t+s}} Y_{t+s}(j)}_{\text{real revenue}} 
- \underbrace{\frac{\text{MC}_{t+s}}{P_{t+s}} \cdot Y_{t+s}(j)}_{\text{real cost}} 
- \underbrace{\frac{\phi_p}{2} \left( \frac{P_{t+s}(j)}{P_{t+s-1}(j)} - 1 \right)^2 Y_{t+s}}_{\text{price adjustment cost}}
\right]
\label{intermediate_objective}
\end{equation}


In equation \eqref{intermediate_objective}, $\Lambda_{t,t+s} = \beta^s \frac{\lambda_{t+s}}{\lambda_t}$ is the stochastic discount factor, capturing how households value future profits relative to today, where $\lambda_t$ is the marginal utility of consumption. The parameter $\phi_p > 0$ is the magnitude of price adjustment costs - a higher $\phi_p$ implies greater penalties for changing prices rapidly. Finally, $Y_{t+s}(j)$ is the firm-specific demand, which depends on the relative price $\frac{P_{t+s}(j)}{P_{t+s}}$ and aggregate output $Y_{t+s}$, as derived from the CES demand curve in Equation \eqref{demand_curve_final}.



Each intermediate firm $j$ chooses its price path to maximize the expected discounted sum of real profits, taking into account Rotemberg‐style quadratic adjustment costs. In symmetric equilibrium—where $P_t(j)=P_t$ for all $j$ and $\pi_t \equiv P_t/P_{t-1}$—the first‐order condition collapses into the familiar Rotemberg Phillips Curve (see Appendix \ref{intermediate_good_producer_appendix} for the full derivation):
    
\begin{equation}
(\pi_t - 1)\pi_t = \frac{\epsilon}{\phi_p} \left( mc_t - \frac{\epsilon-1}{\epsilon} \right) + \beta \mathbb{E}_t \left[ \frac{\lambda_{t+1}}{\lambda_t} \frac{Y_{t+1}}{Y_t} (\pi_{t+1} - 1)\pi_{t+1} \right]
\label{nkpc}
\end{equation}

\begin{equation}
mc_t = \frac{\text{MC}_t}{P_t}
\label{real_mc}
\end{equation}

In this expression, $mc_t = \tfrac{\mathrm{MC}_t}{P_t}$ denotes the real marginal cost, and $\tfrac{\epsilon-1}{\epsilon}$ is its flexible‐price benchmark. The left‐hand side captures current inflation’s departure from unity, while the first term on the right relates that departure to real marginal cost gaps scaled by the adjustment‐cost parameter $\phi_p$. A larger $\phi_p$ makes prices stickier, damping the response of inflation to cost pressures. The second term brings in expected future inflation, discounted by $\beta$, adjusted for households’ intertemporal marginal‐utility ratio $\lambda_{t+1}/\lambda_t$ and relative output growth $Y_{t+1}/Y_t$. Together, these components link today’s inflation dynamics to both real‐economic conditions and expectations of tomorrow’s price adjustments.



## Government Sector 

Government sector is from @sims2024fiscal's notes. Government chooses spending, (term), exogenously. It finances spending with lump-sum taxes and issues new debt. 



Gov budget constraint (nominal)
\begin{equation}
G_t + R^B_{t-1} D_{t-1} \leq D_t + P_t \tau_t \label{Gov_Budget}
\end{equation}


With $R^Bt$ being the interest rate on bonds for period $t$.






To ensure internal consistency, I introduce a simple government sector. The government issues one-period nominal bonds purchased by households, uses tax revenues to finance an exogenous stream of government spending, and services its debt obligations. The government budget constraint equates the sum of nominal spending and interest payments to the sum of new debt issuance and tax revenues. I assume lump-sum taxation and do not model Ricardian equivalence effects explicitly. Bonds held by households are thus assumed to be government-issued, closing the financial side of the model.






















## Monetary Authority 
The central bank sets the nominal interest rate $R_t$ according to:  
\begin{equation}
R_t = \rho_R R_{t-1} + (1 - \rho_R) \left[ R_* + \phi_\pi (\pi_t - \pi_*) + \phi_y \left( \frac{Y_t - Y_*}{Y_*} \right) \right] + \varepsilon_t^R
\label{taylor_rule}
\end{equation}




The policy rate $(R_t)$ sets the nominal return on government bonds $(R_t^B)$ implying with no risk premium.
 
 
 

# Market Clearing and Equilibrium






## Resource Constraint
(Goods Market Clearing) 

\begin{equation}
   Y_t = c_t + i_t + g_t + \frac{\phi_k}{2} \left( \frac{i_t}{K_{t-1}} - \delta \right)^2 K_{t-1} + \frac{\phi_p}{2} (\pi_t - 1)^2 Y_t
   \label{clearing_resource_constraint}
\end{equation}


\begin{equation}
R_t^B = R_t 
\label{interest_parity}
\end{equation}

## Factor Market Clearing




## Definition of Equilibrium


A competitive equilibrium is a set of prices () and allocations () such that (i) household and rm optimality conditions all hold, (ii) the rm hires all the labour and capital supplied by the household, (iii) the household and rm budget constraints hold with equality, and (iv) household bond-holdings equal government debt issuance in all periods (i.e. Bt+1 = Dt+1, and we require that Bt = Dt initially), given values and stochastic processes of Gt and At, as well as initial values of government debt and household bond-holdings, which must be equal (e.g. Bt =Dt).


\begin{equation}
B_t = D_t
\label{Bond_market_clear}
\end{equation}
     


### Natural (flexible‐price) equilibrium

The equilibrium when prices are fully flexible. Therefore set $\phi_p$ to 0 and solve. This should set prices opitimally each period without adjustment costs. Inflation dynamics vanish, simplifying the philips curve. Output and the natrual real rate are purely determined by real economic forces (technology, preferences, and capital accumulation)

Natural (Flexible-Price) Equilibrium
Set \( \phi_p = 0 \) in all equations. The equation firms are simplifies to:  

\begin{equation}
\max_{P_t(j)} \mathbb{E}_t \sum_{s=0}^{\infty} \beta^s \Lambda_{t,t+s} \left[
\underbrace{\frac{P_{t+s}(j)}{P_{t+s}} Y_{t+s}(j)}_{\text{real revenue}} 
- \underbrace{\frac{\text{MC}_{t+s}}{P_{t+s}} \cdot Y_{t+s}(j)}_{\text{real cost}} 
\right]
\label{intermediate_objective_frictionless}
\end{equation}


Thus we get 
\begin{equation}
mc_t = \frac{\epsilon - 1}{\epsilon}
\end{equation}


Real marginal cost \(mc_t\) is constant at $\frac{\epsilon - 1}{\epsilon}$ (inverse markup). The natural level of output \(Y_t^*\) is the output level consistent with this \(mc_t\) in the flexible-price equilibrium. Using the production structure and resource constraints from the provided equations. Derived in Appendix. 



**Unsure if I should be more expansive here? Must I derive equations for the natural real rate and natural level of output $Y_t^*$ ? Would this fix  my mod file? **


# Exogenous Processes

Government spending, taxes, and technology evolve according to exogenous AR(1) processes.

Real taxes follow Equation \eqref{real_taxes},
\begin{equation}
\tau_t = (1-\rho_\tau)\bar{\tau} + \rho_\tau \tau_{t-1} + \varepsilon_t^\tau 
\label{real_taxes}
\end{equation}
where $\bar{\tau}$ is the steady-state level, $\rho_\tau$ controls persistence, and $\varepsilon_t^\tau$ is a fiscal shock.

Government spending is governed by Equation \eqref{gov_spending},
\begin{equation}
g_t = (1-\rho_g)\bar{g} + \rho_g g_{t-1} + \varepsilon_t^g 
\label{gov_spending}
\end{equation}
with similar dynamics: mean reversion around $\bar{g}$ and shocks $\varepsilon_t^g$.

Technology evolves log-linearly as in Equation \eqref{technology_process},
\begin{equation}
\ln A_t = \rho_a \ln A_{t-1} + \varepsilon_t^a 
\label{technology_process}
\end{equation}
ensuring a unit steady-state level and allowing for persistent TFP shocks.
 



\newpage


# Full Set of Conditions



\begin{equation}
\pi_t = \frac{P_t}{P_{t-1}}
\tag{\ref{inflation}}
\end{equation}


\begin{equation}
c_t = \frac{C_t}{P_t}, 
\quad i_t = \frac{I_t}{P_t}, 
\quad g_t = \frac{G_t}{P_t},
\quad b_t = \frac{B_t}{P_t}
\tag{\ref{real_conversions}}
\end{equation}

\begin{equation}
C_t \;+\; I_t \;+\; B_t \;+\; M_t
\;\le\;
R^B_{\,t-1}\,B_{t-1}
\;+\; M_{t-1}
\;+\; W_t\,h_t
\;+\; R^k_t\,K_{t-1}
\;+\; \Pi_t
\;-\; P_t\,\tau_t
\tag{\ref{flow_constraint_nominal}}
\end{equation}


\begin{equation}
K_t
\;=\;
(1 - \delta)\,K_{t-1}
\;+\; i_t
\;-\;\frac{\phi_k}{2}
\left(\frac{i_t}{K_{t-1}} - \delta\right)^{2}
\,K_{t-1}
\tag{\ref{capital_accumulation_real}}
\end{equation}


\begin{equation}\tag{\ref{foc_C}}
{
  \lambda_t P_t = (c_t-\eta c_{t-1})^{-\theta} - \beta\eta\,\mathbb{E}_t\bigl[(c_{t+1}-\eta c_t)^{-\theta}\bigr]
}
\end{equation}

\begin{equation}\tag{\ref{foc_h}}
{\lambda_t W_t = \chi h_t^{\gamma}}
\end{equation}

\begin{equation}\tag{\ref{foc_M}}
{\frac{\psi}{M_t} = \lambda_t - \beta\,\mathbb{E}_t[\lambda_{t+1}]}
\end{equation}

\begin{equation}\tag{\ref{foc_B}}
{\lambda_t = \beta\,\mathbb{E}_t[\lambda_{t+1}R^B_t]}
\end{equation}


\begin{equation}\tag{\ref{foc_I}}
{\lambda_t P_t = \mu_t 
  \Bigl[ 1 - \phi_k\bigl( \tfrac{I_t}{P_t K_{t-1}} - \delta \bigr) \Bigr]}
\end{equation}

\begin{equation}\tag{\ref{foc_K}}
{\mu_t = \beta\,\mathbb{E}_t\Bigl[
        \lambda_{t+1}R^k_{t+1}
      + \mu_{t+1}\Bigl(
          (1-\delta)
        + \tfrac{\phi_k}{2}\Bigl(
            \bigl(\tfrac{I_{t+1}}{P_{t+1}K_t}\bigr)^2
          - \delta^2
          \Bigr)
        \Bigr)
      \Bigr]}  
\end{equation}



\begin{equation}
Y_t(j) = A_t K_t(j)^{\alpha} h_t(j)^{1-\alpha}
\tag{\ref{intermediate_production}}
\end{equation}

\begin{equation}
Y_t = A_t K_{t-1}^\alpha h_t^{1-\alpha}
\tag{\ref{aggregate_production_ss}}
\end{equation}


\begin{equation}
\Pi_t = P_t Y_t - R^k_t K_{t-1} - W_t h_t - \frac{\phi_p}{2} (\pi_t - 1)^2 P_t Y_t
\tag{\ref{intermediate_firm_profit}}
\end{equation}



\begin{equation}
R_t^k = MC_t \alpha A_t K_t(j)^{\alpha-1} h_t(j)^{1-\alpha}
\tag{\ref{Capital_Demand_Condition}}
\end{equation}

\begin{equation}
W_t = MC_t (1-\alpha) A_t K_t(j)^{\alpha} h_t(j)^{-\alpha}
\tag{\ref{Labour_Demand_Condition}}
\end{equation}


\begin{equation}
\text{MC}_t = \frac{1}{A_t} \left( \frac{R_t^k}{\alpha} \right)^{\alpha} \left( \frac{W_t}{1-\alpha} \right)^{1-\alpha}
\tag{\ref{marginal_cost}}
\end{equation}

\begin{equation}
mc_t = \frac{\text{MC}_t}{P_t}
\tag{\ref{real_mc}}
\end{equation}

\begin{equation}
(\pi_t - 1)\pi_t = \frac{\epsilon}{\phi_p} \left( mc_t - \frac{\epsilon-1}{\epsilon} \right) + \beta \mathbb{E}_t \left[ \frac{\lambda_{t+1}}{\lambda_t} \frac{Y_{t+1}}{Y_t} (\pi_{t+1} - 1)\pi_{t+1} \right]
\tag{\ref{nkpc}}
\end{equation}

\begin{equation}
G_t + R^B_{t-1} D_{t-1} \leq D_t + P_t \tau_t 
\tag{\ref{Gov_Budget}}
\end{equation}

\begin{equation}
B_t = D_t
\tag{\ref{Bond_market_clear}}
\end{equation}

\begin{equation}
R_t^B = R_t
\tag{\ref{interest_parity}}
\end{equation}

\begin{equation}
R_t = \rho_R R_{t-1} + (1 - \rho_R) \left[ R_* + \phi_\pi (\pi_t - \pi_*) + \phi_y \left( \frac{Y_t - Y_*}{Y_*} \right) \right] + \varepsilon_t^R
\tag{\ref{taylor_rule}}
\end{equation}



\begin{equation}
   Y_t = c_t + i_t + g_t + \frac{\phi_k}{2} \left( \frac{i_t}{K_{t-1}} - \delta \right)^2 K_{t-1} + \frac{\phi_p}{2} (\pi_t - 1)^2 Y_t
\tag{\ref{clearing_resource_constraint}}
\end{equation}


\begin{equation}
\tau_t = (1-\rho_\tau)\bar{\tau} + \rho_\tau \tau_{t-1} + \varepsilon_t^\tau 
\tag{\ref{real_taxes}}
\end{equation}


\begin{equation}
g_t = (1-\rho_g)\bar{g} + \rho_g g_{t-1} + \varepsilon_t^g 
\tag{\ref{gov_spending}}
\end{equation}



\begin{equation}
\ln A_t = \rho_a \ln A_{t-1} + \varepsilon_t^a 
\tag{\ref{technology_process}}
\end{equation}

\begin{equation} 
\tag{\ref{steady_interest}}
R_* = \frac{\pi_*}{\beta}
\end{equation}


\begin{equation}
\tag{\ref{steady_capital_return_real}}
r^k_* = \frac{1}{\beta} - (1-\delta)
\end{equation}









# Steady State



Equations \eqref{steady_interest} and \eqref{steady_capital_return_real} are derived in the appendix under \ref{steady_state_app}

\begin{equation} \label{steady_interest}
R_* = \frac{\pi_*}{\beta}
\end{equation}


\begin{equation}
\label{steady_capital_return_real}
r^k_* = \frac{1}{\beta} - (1-\delta)
\end{equation}

\begin{equation}
Y_t = A_t K_{t-1}^\alpha h_t^{1-\alpha}
\label{aggregate_production_ss}
\end{equation}

Equation \eqref{aggregate_production_ss} is added because I know dynare drops the j subscript.


```{r running-dynare, eval=FALSE}


nkm_results <- run_dynare(
  code       = dynareCodes_NKM,    # <— correct name here
  model      = "code/nkm_model",
  import_log = TRUE)

dynare$nkm_model$steady
```

![image](code/rbc_model/rbc_model/graphs/rbc_model_IRF_eps_cropped.png "Title")





# New



\begin{equation}
\pi_t = \frac{P_t}{P_{t-1}}
\tag{\ref{inflation}}
\end{equation}


\begin{equation}
c_t = \frac{C_t}{P_t}, 
\quad i_t = \frac{I_t}{P_t}, 
\quad g_t = \frac{G_t}{P_t},
\quad b_t = \frac{B_t}{P_t}
\tag{\ref{real_conversions}}
\end{equation}

\begin{equation}
c_t\,Pt \;+\; i_t\,Pt \;+\; b_t\,Pt \;+\; m_t\,Pt
\;\le\;
R^B_{\,t-1}\,b_{t-1}\,P_{t-1}
\;+\; m_{t-1}\,P_{t-1}
\;+\; W_t\,h_t
\;+\; R^k_t\,K_{t-1}
\;+\; \Pi_t
\;-\; P_t\,\tau_t
\tag{\ref{flow_constraint_nominal}}
\end{equation}


\begin{equation}
K_t
\;=\;
(1 - \delta)\,K_{t-1}
\;+\; i_t
\;-\;\frac{\phi_k}{2}
\left(\frac{i_t}{K_{t-1}} - \delta\right)^{2}
\,K_{t-1}
\tag{\ref{capital_accumulation_real}}
\end{equation}


\begin{equation}\tag{\ref{foc_C}}
{
  \lambda_t P_t = (c_t-\eta c_{t-1})^{-\theta} - \beta\eta\,\mathbb{E}_t\bigl[(c_{t+1}-\eta c_t)^{-\theta}\bigr]
}
\end{equation}

\begin{equation}\tag{\ref{foc_h}}
{\lambda_t W_t = \chi h_t^{\gamma}}
\end{equation}

\begin{equation}\tag{\ref{foc_M}}
{\frac{\psi}{m_t\,P_t} = \lambda_t - \beta\,\mathbb{E}_t[\lambda_{t+1}]}
\end{equation}

\begin{equation}\tag{\ref{foc_B}}
{\lambda_t = \beta\,\mathbb{E}_t[\lambda_{t+1}R^B_t]}
\end{equation}


\begin{equation}\tag{\ref{foc_I}}
{\lambda_t P_t = \mu_t 
  \Bigl[ 1 - \phi_k\bigl( \tfrac{i_t}{K_{t-1}} - \delta \bigr) \Bigr]}
\end{equation}

\begin{equation}\tag{\ref{foc_K}}
{\mu_t = \beta\,\mathbb{E}_t\Bigl[
        \lambda_{t+1}R^k_{t+1}
      + \mu_{t+1}\Bigl(
          (1-\delta)
        + \tfrac{\phi_k}{2}\Bigl(
            \bigl(\tfrac{i_{t+1}}{K_t}\bigr)^2
          - \delta^2
          \Bigr)
        \Bigr)
      \Bigr]}  
\end{equation}



\begin{equation}
Y_t(j) = A_t K_t(j)^{\alpha} h_t(j)^{1-\alpha}
\tag{\ref{intermediate_production}}
\end{equation}

\begin{equation}
Y_t = A_t K_{t-1}^\alpha h_t^{1-\alpha}
\tag{\ref{aggregate_production_ss}}
\end{equation}


\begin{equation}
\Pi_t = P_t Y_t - R^k_t K_{t-1} - W_t h_t - \frac{\phi_p}{2} (\pi_t - 1)^2 P_t Y_t
\tag{\ref{intermediate_firm_profit}}
\end{equation}



\begin{equation}
R_t^k = MC_t \alpha A_t K_t(j)^{\alpha-1} h_t(j)^{1-\alpha}
\tag{\ref{Capital_Demand_Condition}}
\end{equation}

\begin{equation}
W_t = MC_t (1-\alpha) A_t K_t(j)^{\alpha} h_t(j)^{-\alpha}
\tag{\ref{Labour_Demand_Condition}}
\end{equation}


\begin{equation}
\text{MC}_t = \frac{1}{A_t} \left( \frac{R_t^k}{\alpha} \right)^{\alpha} \left( \frac{W_t}{1-\alpha} \right)^{1-\alpha}
\tag{\ref{marginal_cost}}
\end{equation}



\begin{equation}
(\pi_t - 1)\pi_t = \frac{\epsilon}{\phi_p} \left(  \frac{\text{MC}_t}{P_t} - \frac{\epsilon-1}{\epsilon} \right) + \beta \mathbb{E}_t \left[ \frac{\lambda_{t+1}}{\lambda_t} \frac{Y_{t+1}}{Y_t} (\pi_{t+1} - 1)\pi_{t+1} \right]
\tag{\ref{nkpc}}
\end{equation}

\begin{equation}
g_t\,P_t + R^B_{t-1} d_{t-1}\,P_{t-1} \leq d_t\,P_{t} + P_t \tau_t 
\tag{\ref{Gov_Budget}}
\end{equation}

\begin{equation}
b_t\,P_t = d_t\,P_t
\tag{\ref{Bond_market_clear}}
\end{equation}

\begin{equation}
R_t^B = R_t
\tag{\ref{interest_parity}}
\end{equation}

\begin{equation}
R_t = \rho_R R_{t-1} + (1 - \rho_R) \left[ R_* + \phi_\pi (\pi_t - \pi_*) + \phi_y \left( \frac{Y_t - Y_*}{Y_*} \right) \right] + \varepsilon_t^R
\tag{\ref{taylor_rule}}
\end{equation}



\begin{equation}
   Y_t = c_t + i_t + g_t + \frac{\phi_k}{2} \left( \frac{i_t}{K_{t-1}} - \delta \right)^2 K_{t-1} + \frac{\phi_p}{2} (\pi_t - 1)^2 Y_t
\tag{\ref{clearing_resource_constraint}}
\end{equation}


\begin{equation}
\tau_t = (1-\rho_\tau)\bar{\tau} + \rho_\tau \tau_{t-1} + \varepsilon_t^\tau 
\tag{\ref{real_taxes}}
\end{equation}


\begin{equation}
g_t = (1-\rho_g)\bar{g} + \rho_g g_{t-1} + \varepsilon_t^g 
\tag{\ref{gov_spending}}
\end{equation}



\begin{equation}
\ln A_t = \rho_a \ln A_{t-1} + \varepsilon_t^a 
\tag{\ref{technology_process}}
\end{equation}

\begin{equation} 
\tag{\ref{steady_interest}}
R_* = \frac{\pi_*}{\beta}
\end{equation}


\begin{equation}
\tag{\ref{steady_capital_return_real}}
r^k_* = \frac{1}{\beta} - (1-\delta)
\end{equation}


























































































\newpage
\newpage


# Appendix  

## Households

 
\begin{align*}
  & \text{Define Lagrangian} \\
  & \mathcal{L} = \mathbb{E}_0 \sum_{t=1}^{\infty} \beta^{t-1} \Bigl\{
    \underbrace{\frac{\bigl(\tfrac{C_t}{P_t}-\eta\tfrac{C_{t-1}}{P_{t-1}}\bigr)^{1-\theta}}{1-\theta}}_{\text{Consumption utility}}
    - \underbrace{\chi\frac{h_t^{1+\gamma}}{1+\gamma}}_{\text{Labor disutility}}
    + \underbrace{\psi\ln\bigl(\tfrac{M_t}{P_t}\bigr)}_{\text{Money utility}} \\
  & \quad\qquad
    + \underbrace{\lambda_t\bigl[R^B_{t-1}B_{t-1}+M_{t-1}+W_th_t+R^k_tK_{t-1}+\Pi_t-P_t\tau_t-C_t-I_t-B_t-M_t\bigr]}_{\text{Nominal flow constraint}}
    + \underbrace{\mu_t\bigl[(1-\delta)K_{t-1}+\tfrac{I_t}{P_t}-\tfrac{\phi_k}{2}(\tfrac{I_t/P_t}{K_{t-1}}-\delta)^2K_{t-1}-K_t\bigr]}_{\text{Capital accumulation}}
  \Bigr\}
\end{align*}





### First Order Conditions \label{household_FOC}



**FOC w.r.t. Consumption** :
\begin{align*}
  & \frac{\partial \mathcal{L}}{\partial C_t} = 0 \\
  & \quad \bigl[(c_t-\eta c_{t-1})^{-\theta}/P_t - \lambda_t\bigr]
    - \beta\,\mathbb{E}_t\bigl[\eta\,(c_{t+1}-\eta c_t)^{-\theta}/P_t\bigr] = 0 \\[6pt]
  & \text{Combine terms over }1/P_t \\
  & \quad \frac{1}{P_t}\bigl[(c_t-\eta c_{t-1})^{-\theta} - \beta\eta\,\mathbb{E}_t[(c_{t+1}-\eta c_t)^{-\theta}]\bigr] - \lambda_t = 0 \\[6pt]
  & \text{Multiply by }P_t \\
  & \quad (c_t-\eta c_{t-1})^{-\theta} - \beta\eta\,\mathbb{E}_t[(c_{t+1}-\eta c_t)^{-\theta}] - \lambda_t P_t = 0
\end{align*}

\begin{equation}\label{foc_C_app}
\boxed{
  \lambda_t P_t = (c_t-\eta c_{t-1})^{-\theta} - \beta\eta\,\mathbb{E}_t\bigl[(c_{t+1}-\eta c_t)^{-\theta}\bigr]
}
\end{equation}


**FOC w.r.t. Labour** :
\begin{align*}
  & \frac{\partial \mathcal{L}}{\partial h_t} = 0 \\
  & \quad -\chi h_t^{\gamma} + \lambda_t W_t = 0 \\[6pt]
  & \text{Rearrange} \\
  & \quad \lambda_t W_t = \chi h_t^{\gamma}
\end{align*}

\begin{equation}\label{foc_h_app}
\boxed{\lambda_t W_t = \chi h_t^{\gamma}}
\end{equation}


**FOC w.r.t. Real Money Balances**:
\begin{align*}
  & \frac{\partial \mathcal{L}}{\partial M_t} = 0 \\
  & \quad \beta^{t-1}\bigl[\psi/M_t - \lambda_t\bigr] + \beta^t\mathbb{E}_t[\lambda_{t+1}] = 0 \\[6pt]
  & \text{Divide by }\beta^{t-1}\text{ and rearrange} \\
  & \quad \psi/M_t - \lambda_t + \beta\,\mathbb{E}_t[\lambda_{t+1}] = 0
\end{align*}

\begin{equation}\label{foc_M_app}
\boxed{\frac{\psi}{M_t} = \lambda_t - \beta\,\mathbb{E}_t[\lambda_{t+1}]}
\end{equation}


**FOC w.r.t. Bonds** :
\begin{align*}
  & \frac{\partial \mathcal{L}}{\partial B_t} = 0 \\
  & \quad -\beta^{t-1}\lambda_t + \beta^t\mathbb{E}_t[\lambda_{t+1}R^B_t] = 0 \\[6pt]
  & \text{Divide by }\beta^{t-1}\text{ and simplify} \\
  & \quad -\lambda_t + \beta\,\mathbb{E}_t[\lambda_{t+1}R^B_t] = 0
\end{align*}

\begin{equation}\label{foc_B_app}
\boxed{\lambda_t = \beta\,\mathbb{E}_t[\lambda_{t+1}R^B_t]}
\end{equation}



**FOC w.r.t. Investment**:
\begin{align*}
  & \frac{\partial \mathcal{L}}{\partial I_t} = 0 \\
  & \quad \beta^{t-1}\Bigl[ -\lambda_t 
      + \mu_t \cdot \frac{1}{P_t} 
        \Bigl( 1 - \phi_k\bigl( \tfrac{I_t/P_t}{K_{t-1}} - \delta \bigr) \Bigr)
    \Bigr] = 0 \\[6pt]
  & \text{Divide by }\beta^{t-1}\text{ and rearrange} \\
  & \quad \lambda_t = \frac{\mu_t}{P_t} 
        \Bigl[ 1 - \phi_k\bigl( \tfrac{I_t}{P_t K_{t-1}} - \delta \bigr) \Bigr] \\[6pt]
  & \text{Multiply both sides by }P_t \\
  & \quad \lambda_t P_t = \mu_t 
        \Bigl[ 1 - \phi_k\bigl( \tfrac{I_t}{P_t K_{t-1}} - \delta \bigr) \Bigr]
\end{align*}

\begin{equation}\label{foc_I_app}
\boxed{\lambda_t P_t = \mu_t 
  \Bigl[ 1 - \phi_k\bigl( \tfrac{I_t}{P_t K_{t-1}} - \delta \bigr) \Bigr]}
\end{equation}

**FOC w.r.t. Capital**:
\begin{align*}
  & \frac{\partial \mathcal{L}}{\partial K_t} = 0 \\
  & \quad -\beta^{t-1}\mu_t 
    + \beta^t\mathbb{E}_t\Bigl[
        \lambda_{t+1}R^k_{t+1}
      + \mu_{t+1}\Bigl(
          (1-\delta) 
        + \tfrac{\phi_k}{2}\Bigl(
            \bigl(\tfrac{I_{t+1}}{P_{t+1}K_t}\bigr)^2 
          - \delta^2
          \Bigr)
        \Bigr)
      \Bigr] = 0 \\[6pt]
  & \text{Divide by }\beta^{t-1}\text{ and solve} \\
  & \quad \mu_t = \beta\,\mathbb{E}_t\Bigl[
        \lambda_{t+1}R^k_{t+1}
      + \mu_{t+1}\Bigl(
          (1-\delta)
        + \tfrac{\phi_k}{2}\Bigl(
            \bigl(\tfrac{I_{t+1}}{P_{t+1}K_t}\bigr)^2
          - \delta^2
          \Bigr)
        \Bigr)
      \Bigr]  
\end{align*}

\begin{equation}\label{foc_K_app}
\boxed{\mu_t = \beta\,\mathbb{E}_t\Bigl[
        \lambda_{t+1}R^k_{t+1}
      + \mu_{t+1}\Bigl(
          (1-\delta)
        + \tfrac{\phi_k}{2}\Bigl(
            \bigl(\tfrac{I_{t+1}}{P_{t+1}K_t}\bigr)^2
          - \delta^2
          \Bigr)
        \Bigr)
      \Bigr]}  
\end{equation}










## Production 
### Final Good Producer \label{final_good_producer_appendix}

**Derivation of Intermediate Goods Demand and Aggregate Price Index**  

\begin{align*}  
& \text{Final goods producer's profit:} \\  
& \Pi_t = P_t Y_t - \int_0^1 P_t(j) Y_t(j)  dj \\  
& \text{subject to } Y_t = \left( \int_0^1 Y_t(j)^{\frac{\epsilon-1}{\epsilon}}  dj \right)^{\frac{\epsilon}{\epsilon-1}} \\  
& \\  
& \text{Substitute production function into profit:} \\  
& \Pi_t = P_t \left( \int_0^1 Y_t(j)^{\frac{\epsilon-1}{\epsilon}}  dj \right)^{\frac{\epsilon}{\epsilon-1}} - \int_0^1 P_t(j) Y_t(j)  dj \\  
& \\  
& \text{First-order condition for } Y_t(j): \\  
& \frac{\partial \Pi_t}{\partial Y_t(j)} = P_t \cdot \frac{\epsilon}{\epsilon-1} \left( \int_0^1 Y_t(i)^{\frac{\epsilon-1}{\epsilon}}  di \right)^{\frac{1}{\epsilon-1}} \cdot \frac{\epsilon-1}{\epsilon} Y_t(j)^{-\frac{1}{\epsilon}} - P_t(j) = 0 \\  
& \Rightarrow P_t \cdot Y_t^{\frac{1}{\epsilon}} Y_t(j)^{-\frac{1}{\epsilon}} = P_t(j) \\  
& \\  
& \text{Rearrange to obtain demand curve:} \\  
& Y_t(j) = \left( \frac{P_t}{P_t(j)} \right)^{\epsilon} Y_t \\  
& \\  
& \text{Substitute demand into production function:} \\  
& Y_t = \left( \int_0^1 \left[ \left( \frac{P_t}{P_t(j)} \right)^{\epsilon} Y_t \right]^{\frac{\epsilon-1}{\epsilon}}  dj \right)^{\frac{\epsilon}{\epsilon-1}} \\  
& = Y_t \left( \int_0^1 \left( \frac{P_t}{P_t(j)} \right)^{\epsilon-1}  dj \right)^{\frac{\epsilon}{\epsilon-1}} \\  
& \\
\end{align*}
\begin{align*} 
& \text{Simplify to obtain price index:} \\  
& 1 = \left( \int_0^1 \left( \frac{P_t}{P_t(j)} \right)^{\epsilon-1}  dj \right)^{\frac{\epsilon}{\epsilon-1}} \\  
& \Rightarrow P_t^{1-\epsilon} = \int_0^1 P_t(j)^{1-\epsilon}  dj \\  
& \Rightarrow P_t = \left( \int_0^1 P_t(j)^{1-\epsilon}  dj \right)^{\frac{1}{1-\epsilon}}  
\end{align*}  

\begin{equation}\label{demand_and_price}  
\boxed{  
  \begin{gathered}  
  Y_t(j) = \left( \frac{P_t(j)}{P_t} \right)^{-\epsilon} Y_t \\  
  \\  
  P_t = \left( \int_0^1 P_t(j)^{1-\epsilon}  dj \right)^{\frac{1}{1-\epsilon}}  
  \end{gathered}  
}  
\end{equation}  

### Intermediate Goods Producers \label{intermediate_good_producer_appendix}

\begin{align*}
& \text{Cost minimization for intermediate firm } j: \\
& \min_{K_t(j), h_t(j)} \left\{ R_t^k K_t(j) + W_t h_t(j) \right\} \\
& \text{subject to } Y_t(j) = A_t K_t(j)^{\alpha} h_t(j)^{1-\alpha} \\
& \\
& \text{Lagrangian:} \\
& \mathcal{L} = R_t^k K_t(j) + W_t h_t(j) + \lambda_t \left[ A_t K_t(j)^{\alpha} h_t(j)^{1-\alpha} - Y_t(j) \right] \\
& \\
& \text{First-order conditions:} \\
& \frac{\partial \mathcal{L}}{\partial K_t(j)} = 0: \quad R_t^k = \lambda_t \alpha A_t K_t(j)^{\alpha-1} h_t(j)^{1-\alpha} \\
& \frac{\partial \mathcal{L}}{\partial h_t(j)} = 0: \quad W_t = \lambda_t (1-\alpha) A_t K_t(j)^{\alpha} h_t(j)^{-\alpha} \\
& \\
& \text{Rearrange FOCs:} \\
& \lambda_t = \frac{R_t^k}{\alpha} \left( \frac{K_t(j)}{h_t(j)} \right)^{1-\alpha} \frac{1}{A_t}, \quad 
\lambda_t = \frac{W_t}{1-\alpha} \left( \frac{K_t(j)}{h_t(j)} \right)^{\alpha} \frac{1}{A_t} \\
& \\
& \text{Equate expressions:} \\
& \frac{R_t^k}{\alpha} \left( \frac{K_t(j)}{h_t(j)} \right)^{-\alpha} = \frac{W_t}{1-\alpha} \left( \frac{K_t(j)}{h_t(j)} \right)^{1-\alpha} \\
& \Rightarrow \frac{K_t(j)}{h_t(j)} = \frac{\alpha}{1-\alpha} \frac{W_t}{R_t^k} \\
& \\
& \text{Substitute into capital FOC:} \\
& \lambda_t = \frac{R_t^k}{\alpha A_t} \left( \frac{\alpha}{1-\alpha} \frac{W_t}{R_t^k} \right)^{\alpha-1} \\
& = \frac{1}{A_t} \left( \frac{R_t^k}{\alpha} \right)^{\alpha} \left( \frac{W_t}{1-\alpha} \right)^{1-\alpha}
\end{align*}

\begin{equation}\label{marginal_cost_appendix}
\boxed{MC_t = \dfrac{1}{A_t} \left( \dfrac{R_t^k}{\alpha} \right)^{\alpha} \left( \dfrac{W_t}{1-\alpha} \right)^{1-\alpha}}
\end{equation}



\begin{align*}
& \text{Intermediate‐goods producer’s problem:} \\
& \max_{P_t(j)} \;\mathbb{E}_t \sum_{s=0}^{\infty} \Lambda_{t,t+s}
  \Bigl[
    \bigl(\tfrac{P_{t+s}(j)}{P_{t+s}}\bigr)^{1-\epsilon} Y_{t+s}
    - mc_{t+s}\,\bigl(\tfrac{P_{t+s}(j)}{P_{t+s}}\bigr)^{-\epsilon} Y_{t+s}
    - \tfrac{\phi_p}{2}\bigl(\tfrac{P_{t+s}(j)}{P_{t+s-1}(j)} - 1\bigr)^2 Y_{t+s}
  \Bigr] \\
& \text{subject to} \quad Y_t(j) = \bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-\epsilon} Y_t
\\[1.5ex]
& \text{First‐Order Condition w.r.t. }P_t(j): \\
& \mathbb{E}_t\Bigl[
    \frac{\partial \Pi_t(j)}{\partial P_t(j)}
    + \beta\,\Lambda_{t,t+1}
      \frac{\partial \Pi_{t+1}(j)}{\partial P_t(j)}
  \Bigr] = 0
\\[1ex]
& \frac{\partial \Pi_t}{\partial P_t(j)}
  = (1-\epsilon)\bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-\epsilon}\tfrac{Y_t}{P_t}
    + \epsilon\,mc_t\bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-\epsilon-1}\tfrac{Y_t}{P_t}
    - \phi_p\bigl(\tfrac{P_t(j)}{P_{t-1}(j)}-1\bigr)\tfrac{Y_t}{P_{t-1}(j)}
\\[1ex]
& \frac{\partial \Pi_{t+1}}{\partial P_t(j)}
  = \phi_p\bigl(\tfrac{P_{t+1}(j)}{P_t(j)}-1\bigr)\,\tfrac{P_{t+1}(j)}{P_t(j)^2}\,Y_{t+1}
\\[2ex]
& \text{Impose symmetry: }P_t(j)=P_t,\;Y_t(j)=Y_t,\;\pi_t=\tfrac{P_t}{P_{t-1}}.\\
& (1-\epsilon)+\epsilon\,mc_t = \epsilon\bigl(mc_t-\tfrac{\epsilon-1}{\epsilon}\bigr),\quad
  \tfrac{P_t(j)}{P_{t-1}(j)}=\pi_t,\;\tfrac{P_{t+1}(j)}{P_t(j)}=\pi_{t+1}
\\[1ex]
& 0 = \epsilon\bigl(mc_t-\tfrac{\epsilon-1}{\epsilon}\bigr)
      - \phi_p\,(\pi_t-1)\,\pi_t
      + \beta\,\mathbb{E}_t\Bigl[
          \Lambda_{t,t+1}\,\phi_p\,(\pi_{t+1}-1)\,\pi_{t+1}
          \,\tfrac{Y_{t+1}P_t}{Y_tP_{t+1}}
        \Bigr]
\\[1ex]
\end{align*}


Noting \(\Lambda_{t,t+1}=\beta\,\tfrac{\lambda_{t+1}}{\lambda_t}\) and \(P_{t+1}/P_t=\pi_{t+1}\), the bracket simplifies to \(\beta\,\tfrac{\lambda_{t+1}}{\lambda_t}\,\tfrac{Y_{t+1}}{Y_t}\).

\begin{equation}\label{rotemberg_FOC}
\boxed{
  0 = \epsilon\Bigl(mc_t - \tfrac{\epsilon-1}{\epsilon}\Bigr)
      - \phi_p\,(\pi_t - 1)\,\pi_t
      + \beta\,\mathbb{E}_t\!
        \Bigl[
          \tfrac{\lambda_{t+1}}{\lambda_t}\,
          \phi_p\,(\pi_{t+1}-1)\,\pi_{t+1}\,
          \tfrac{Y_{t+1}}{Y_t}
        \Bigr]
}
\end{equation}








\newpage


**Derivation of Firm's First-Order Condition with \(\phi_p = 0\)**

Starting from the firm's optimization problem under Rotemberg pricing, set \(\phi_p = 0\) to eliminate price-adjustment costs:

\begin{align*}
& \max_{P_t(j)} \;\mathbb{E}_t \sum_{s=0}^{\infty} \Lambda_{t,t+s}
  \Bigl[
    \bigl(\tfrac{P_{t+s}(j)}{P_{t+s}}\bigr)^{1-\epsilon} Y_{t+s}
    - mc_{t+s}\,\bigl(\tfrac{P_{t+s}(j)}{P_{t+s}}\bigr)^{-\epsilon} Y_{t+s}
  \Bigr] \\
& \text{subject to} \quad Y_t(j) = \bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-\epsilon} Y_t
\end{align*}

With \(\phi_p = 0\), the problem becomes **static** (no intertemporal links). For any period \(t\), maximize per-period profits:  
\[
\Pi_t(j) = \underbrace{\bigl(\tfrac{P_t(j)}{P_t}\bigr)^{1-\epsilon} Y_t}_{\text{Revenue}} - \underbrace{mc_t \bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-\epsilon} Y_t}_{\text{Production cost}}
\]

First-order condition with respect to \(P_t(j)\):  
\begin{align*}
\frac{\partial \Pi_t(j)}{\partial P_t(j)} 
&= (1-\epsilon) \bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-\epsilon} \tfrac{1}{P_t} Y_t + \epsilon  mc_t \bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-\epsilon-1} \tfrac{1}{P_t} Y_t = 0
\end{align*}

Factor out \(\frac{1}{P_t} \bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-\epsilon} Y_t\):  
\begin{align*}
\bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-\epsilon} \tfrac{Y_t}{P_t} \Bigl[(1-\epsilon) + \epsilon  mc_t \bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-1} \Bigr] &= 0
\end{align*}

Since \(\bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-\epsilon} \frac{Y_t}{P_t} \neq 0\), solve:  
\begin{align*}
(1-\epsilon) + \epsilon  mc_t \bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-1} &= 0 \\
\epsilon  mc_t \bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-1} &= \epsilon - 1 \\
mc_t \bigl(\tfrac{P_t(j)}{P_t}\bigr)^{-1} &= \frac{\epsilon - 1}{\epsilon} \\
\bigl(\tfrac{P_t(j)}{P_t}\bigr) &= \frac{\epsilon}{\epsilon - 1} mc_t
\end{align*}


In symmetric equilibrium, all firms set \(P_t(j) = P_t\). Substituting:  
\begin{align*}
1 &= \frac{\epsilon}{\epsilon - 1} mc_t \\
\end{align*}

\begin{equation}
\boxed{
mc_t = \frac{\epsilon - 1}{\epsilon}
}
\end{equation}






## Steady State \label{steady_state_app}

Steady-State Nominal Interest Rate
\begin{align*}
&\text{From the bond FOC:} &\lambda_t &= \beta \mathbb{E}_t[\lambda_{t+1} R^B_t] \\
&\text{In steady state:} &\lambda &= \beta \lambda R_* \\
&\text{Solving for real rate:} &R_* &= \frac{1}{\beta} \\
&\text{Adjusting for inflation:} &R_*^{\text{nominal}} &= R_* \cdot \pi_* = \frac{\pi_*}{\beta}
\end{align*}

\begin{equation} \label{steady_interest_app}
\boxed{
R_* = \frac{\pi_*}{\beta}
}
\end{equation}

Steady-State Return on Capital
\begin{align*}
&\text{From the capital FOC:} &\mu_t &= \beta \mathbb{E}_t\bigl[\lambda_{t+1} R^k_{t+1} + \mu_{t+1}(1-\delta)\bigr] \\
&\text{Investment adjustment cost zero:} &\frac{I}{P K} &= \delta \\
&\text{Thus:} &\mu &= \beta\bigl[\lambda R^k_* + \mu (1-\delta)\bigr] \\
&\text{From investment FOC:} &\lambda P &= \mu \\
&\text{Substitute }\mu=\lambda P: &\lambda P &= \beta\bigl[\lambda R^k_* + \lambda P(1-\delta)\bigr] \\
&\text{Divide by }\lambda: &P &= \beta R^k_* + \beta P(1-\delta) \\
&\text{Rearrange:} &\beta R^k_* &= P\bigl[1 - \beta(1-\delta)\bigr] \\
&\text{Divide by }\beta: &R^k_* &= \frac{P}{\beta}\bigl[1 - \beta(1-\delta)\bigr] \\
&\text{Real return:} &r^k_* &= \frac{R^k_*}{P} = \frac{1}{\beta} - (1-\delta)
\end{align*}

\begin{equation}
\label{steady_capital_return_real_app}
\boxed{
r^k_* = \frac{1}{\beta} - (1-\delta)
}
\end{equation}








\newpage


\newpage















































































\newpage

# References




```{r model from class,eval=FALSE}


# Note that this is my original MOD file that we used in class, it is here as a means to check if my code actually works in terms of running dynare in R (it does, and i will keep it here as a backup to check in future)
dynareCodes='%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% RBC model with Labor and Log Utility 
% Based on image equations (10)–(17)
% Corrected for B&K conditions (loglinear TFP)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

var C               // Consumption
    I               // Investment
    Y               // Output
    K               // Capital stock
    R               // Return on Capital
    W               // Wage
    H               // Hours worked
    A;              // Productivity level

varexo eps;         // TFP shock

parameters beta alpha delta rho chi;

beta  = 0.99;       // Discount factor
alpha = 0.33;       // Capital share
delta = 0.025;      // Depreciation rate
rho   = 0.95;       // TFP shock persistence
chi   = 2.24;       // Labor disutility parameter

model;
    // (10) Euler equation
    1/C = beta * (1/C(+1)) * (R(+1) + 1 - delta);

    // (11) Labor-leisure trade-off
    (1/C) * W = chi / (1 - H);

    // (12) Resource constraint
    C + I = Y;

    // (13) Return on capital
    R = alpha * Y / K;

    // (14) Wage equation
    W = (1 - alpha) * Y / H;

    // (15) Capital accumulation
    I = K - (1 - delta) * K(-1);

    // (16) Cobb-Douglas production
    Y = A * K^alpha * H^(1 - alpha);

    // (17) Log TFP process
    log(A) = rho * log(A(-1)) + eps;
end;

initval;
    A = 1;
    K = ((alpha * beta / (1 - beta * (1 - delta)))^(1/(1 - alpha)));
    H = 0.33;
    Y = A * K^alpha * H^(1 - alpha);
    I = delta * K;
    C = Y - I;
    R = alpha * Y / K;
    W = (1 - alpha) * Y / H;
end;


steady;
check;
resid;

shocks;
    var eps = 0.01^2; // 1% standard deviation TFP shock
 end;

stoch_simul(order=1, irf=40, hp_filter=1600, loglinear,graph_format=fig) Y C I K H W A R;'

```


```{r, eval=FALSE}

# again this is old code only used for dynostic checking
# 1. Write the .mod file into the code/ folder
write_mod(
  code  = dynareCodes,
  model = "code/rbc_model"
)

# 2. Run Dynare and import the log
rbc_results <- run_dynare(
  code       = dynareCodes,
  model      = "code/rbc_model",
  import_log = TRUE
)
```
